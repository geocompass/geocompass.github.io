{"meta":{"title":"å›½ä¿¡å¸å—æŠ€æœ¯å›¢é˜Ÿåšå®¢","subtitle":"ç³»ç»Ÿå·¥ç¨‹äºŒéƒ¨","description":"å›¢é˜ŸæŠ€æœ¯åšå®¢","author":"Geo-Compass","url":"http://geocompass.github.io","root":"/"},"pages":[],"posts":[{"title":"æ ¼æ—å¨æ²»è½¬ä¸œå…«åŒºæ ¼å¼å·¥å…·","slug":"frontend/GreenwichToEasteight.tool","date":"2019-09-23T16:00:00.000Z","updated":"2020-05-21T01:10:32.134Z","comments":true,"path":"2019/09/24/frontend/GreenwichToEasteight.tool/","link":"","permalink":"http://geocompass.github.io/2019/09/24/frontend/GreenwichToEasteight.tool/","excerpt":"","text":"ä¸€ã€å…³äºå·¥å…·1.1 é—®é¢˜ ä¸­å›½çš„æ ‡å‡†æ—¶é—´ä¸ºæ ¼æ—å¨æ²»æ—¶é—´ + 8 è½¬æ¢åçš„æ ¼å¼é—®é¢˜1.2 éœ€æ±‚ æˆ‘ä»¬å¯èƒ½æƒ³è¦çš„è½¬åŒ–æ ¼å¼ 2017-08-27 22:40:21 2017/08/27 22:401.3 åº”ç”¨code/** * æ ¼æ—å¨æ²»æ—¶é—´è½¬ä¸œå…«åŒº * newdata éœ€è¦è½¬åŒ–çš„æ ¼æ—å¨æ²»æ—¶é—´ï¼Œä¾‹å¦‚\"2019-09-24T00:41:41.201Z\" * format è½¬åŒ–åçš„æ ¼å¼ï¼Œé»˜è®¤\"yyyy-MM-dd hh:mm:ss\"*/const GreenwichToEasteight = (newdata, format = \"yyyy/MM/dd hh:mm\") =&gt; &#123; let that = new Date(newdata); let o = &#123; \"M+\": that.getMonth() + 1, //æœˆä»½ \"d+\": that.getDate(), //æ—¥ \"h+\": that.getHours(), //å°æ—¶ \"m+\": that.getMinutes(), //åˆ† \"s+\": that.getSeconds(), //ç§’ \"q+\": Math.floor((that.getMonth() + 3) / 3), //å­£åº¦ S: that.getMilliseconds() &#125;; if (/(y+)/.test(format)) format = format.replace( RegExp.$1, (that.getFullYear() + \"\").substr(4 - RegExp.$1.length) ); for (let k in o) if (new RegExp(\"(\" + k + \")\").test(format)) format = format.replace( RegExp.$1, RegExp.$1.length == 1 ? o[k] : (\"00\" + o[k]).substr((\"\" + o[k]).length) ); return format;&#125;;export default GreenwichToEasteight; 1.4 ä½¿ç”¨import GreenwichToEasteight from \"\";GreenwichToEasteight(\"2019-09-24T00:41:41.201Z\") // \"2019-09-24 08:41:41\"GreenwichToEasteight(\"2019-09-24T00:41:41.201Z\", \"yyyy/MM/dd hh:mm\") // \"2019/09/24 08:41\"","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://geocompass.github.io/categories/å‰ç«¯/"}],"tags":[{"name":"å‰ç«¯å·¥å…·","slug":"å‰ç«¯å·¥å…·","permalink":"http://geocompass.github.io/tags/å‰ç«¯å·¥å…·/"}],"author":"LOUSANPANG"},{"title":"å‰ç«¯å·¥å…·-definePropertyå®æ—¶ç›‘å¬globalStateå€¼çš„å˜åŒ–","slug":"frontend/DefineProperty.tool","date":"2019-09-04T16:00:00.000Z","updated":"2020-05-21T01:10:32.114Z","comments":true,"path":"2019/09/05/frontend/DefineProperty.tool/","link":"","permalink":"http://geocompass.github.io/2019/09/05/frontend/DefineProperty.tool/","excerpt":"","text":"ä¸€ã€å…³äºå·¥å…·1.1 é—®é¢˜ åœ¨ reactã€taroã€å¾®ä¿¡å°ç¨‹åº ä¸­å¦‚ä½•åšåˆ°åƒ vueçš„watchæ–¹æ³• ä¸€æ ·å»ç›‘å¬å±æ€§çš„å˜åŒ–ï¼Ÿ è™½ç„¶åœ¨ taroã€å¾®ä¿¡å°ç¨‹åº ä¸­çš„ app.js ä¸­å¾®ä¿¡å°ç¨‹åºçš„onLaunch taroçš„componentDidMount ç”Ÿå‘½å‘¨æœŸå¿«äºå„ä¸ªpageé¡µé¢çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†æ˜¯åœ¨app.jsçš„onLaunchæˆ–componentDidMountä¸­å­˜åœ¨å¼‚æ­¥ä¸”æ‰§è¡Œæ—¶é—´å¾ˆé•¿çš„æœåŠ¡æˆ–è€…å»¶æ—¶ï¼Œé‚£åœ¨pageä¸­çš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œçš„å‡½æ•°å¯å°±ä¸ä¸€å®šåœ¨å®ƒä¹‹åæ‰§è¡Œäº†ã€‚ 1.2 éœ€æ±‚ é¢„æœŸè¡Œä¸º å®é™…è¡Œä¸º 1.3 è§£å†³ ä½¿ç”¨åŒæ­¥async awaitå»è§£å†³å¼‚æ­¥ã€å»¶æ—¶ç­‰é—®é¢˜ï¼ˆç¼ºç‚¹ï¼šä½¿ç”¨åŒæ­¥å°±å¿…é¡»åœ¨åŒä¸€ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å»ç­‰å¾…ï¼Œé€ æˆä»£ç èµ˜ä½™ï¼Œä¸æ–¹ä¾¿åœ¨å„ä¸ªé¡µé¢ä½¿ç”¨ã€‚ï¼‰ ä½¿ç”¨Redux Mobxæ•°æ®ç®¡ç†å·¥å…·ï¼ˆç¼ºç‚¹ï¼šå¦‚æœä¸æ˜¯å¾ˆå¤šçš„è·¨ç»„ä»¶æ•°æ®ç›‘å¬ï¼Œæ˜¾çš„è¿‡äºæ²‰é‡ã€‚ï¼‰ ä½¿ç”¨Object.definePropertyå»å®æ—¶ç›‘å¬stateã€globalStateå¯¹è±¡ä¸­çš„å±æ€§çš„å˜åŒ–ã€‚1.4 ä½¿ç”¨// app.jsglobalData: &#123; name: ''&#125;,onLaunch() &#123; let obj = this.globalData setTimeout(() =&gt; &#123; obj.name // è¯»å– obj.name = 'lousanpang' // è®¾ç½® &#125;, 2000)&#125; // index.js$watch() &#123; let obj = app.globalData Object.defineProperty(obj, \"name\", &#123; configurable: true, enumerable: true, get() &#123; // åœ¨onLaunchä¸­è¯»å–obj.nameæ—¶ä¼šè§¦å‘getå‡½æ•° console.log('%c getè¯»å–æˆåŠŸ!', 'background:#1976D2;color:#ffffff') &#125;, set(value) &#123; // åœ¨onLaunchä¸­è®¾ç½®obj.nameæ—¶ä¼šè§¦å‘setå‡½æ•° console.log(`%c setè®¾ç½®æˆåŠŸ: $&#123;value&#125;`, 'background:#ff4400;color:#ffffff') &#125; &#125;);&#125;onLoad: function(options) &#123; let obj = app.globalData this.$watch()&#125; äºŒã€ æ‹“å±•defineProperty2.1 è¯­æ³• è¯­æ³•Object.defineProperty(obj, prop, descriptor) å‚æ•°è¯´æ˜ï¼š objï¼šå¿…éœ€ã€‚ç›®æ ‡å¯¹è±¡propï¼šå¿…éœ€ã€‚éœ€å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„åå­—descriptorï¼šå¿…éœ€ã€‚ç›®æ ‡å±æ€§æ‰€æ‹¥æœ‰çš„ç‰¹æ€§ descriptor åŒ…å«æ•°æ®æè¿°ã€å­˜å–å™¨æè¿°ï¼Œ6ä¸ªå±æ€§ æ•°æ®æè¿° value: è®¾ç½®å±æ€§çš„å€¼ writable: å€¼æ˜¯å¦å¯ä»¥é‡å†™ã€‚true | false enumerable: ç›®æ ‡å±æ€§æ˜¯å¦å¯ä»¥è¢«æšä¸¾ã€‚true | false configurable: ç›®æ ‡å±æ€§æ˜¯å¦å¯ä»¥è¢«åˆ é™¤æˆ–æ˜¯å¦å¯ä»¥å†æ¬¡ä¿®æ”¹ç‰¹æ€§ true | false å­˜å–å™¨æè¿° get:function ()&#123;&#125; | undefined, set:function (value)&#123;&#125; | undefined æ³¨æ„ï¼šå½“ä½¿ç”¨äº†getteræˆ–setteræ–¹æ³•ï¼Œä¸å…è®¸ä½¿ç”¨writableå’Œvalueè¿™ä¸¤ä¸ªå±æ€§ 2.2 ä½¿ç”¨ æ•°æ®æè¿° let obj = &#123;&#125;Object.defineProperty(obj, \"name\", &#123; value: \"lousanpang\", writable: true, enumerable: true, configurable: true&#125;);// è¯»å–console.log( obj.name ); // lousanpang//æšä¸¾å¯¹è±¡çš„å±æ€§for( var val in obj )&#123; console.log( val ); // lousanpang&#125;// åˆ é™¤delete obj.name;console.log( obj.name ); // undefined å­˜å–å™¨æè¿° let obj = &#123; name: ''&#125;;Object.defineProperty(obj, \"name\", &#123; get() &#123; //å½“è·å–å€¼çš„æ—¶å€™è§¦å‘ conosle.log('get!') &#125;, set(value) &#123; //å½“è®¾ç½®å€¼çš„æ—¶å€™è§¦å‘,è®¾ç½®çš„æ–°å€¼é€šè¿‡å‚æ•°valueæ‹¿åˆ° console.log(value) &#125;&#125;);console.log( obj.name ); // è·å–å€¼ ''obj.name = 'lousanpang'; // è®¾ç½®å€¼console.log( obj.name ); // lousanpang// è§¦å‘set æ‰“å°value--lousanpang ä¸‰ã€Object.defineProperty","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://geocompass.github.io/categories/å‰ç«¯/"}],"tags":[{"name":"å‰ç«¯å·¥å…·","slug":"å‰ç«¯å·¥å…·","permalink":"http://geocompass.github.io/tags/å‰ç«¯å·¥å…·/"},{"name":"react","slug":"react","permalink":"http://geocompass.github.io/tags/react/"},{"name":"taro","slug":"taro","permalink":"http://geocompass.github.io/tags/taro/"},{"name":"å°ç¨‹åº","slug":"å°ç¨‹åº","permalink":"http://geocompass.github.io/tags/å°ç¨‹åº/"}],"author":"LOUSANPANG"},{"title":"æ›´å¿«æ·çš„PG+PostGISè½¬æ¢ç«æ˜Ÿåæ ‡ç³»æ–¹æ³•","slug":"database/æ›´å¿«æ·çš„PG-PostGISè½¬æ¢ç«æ˜Ÿåæ ‡ç³»æ–¹æ³•","date":"2019-08-22T06:38:14.000Z","updated":"2020-05-21T01:10:32.113Z","comments":true,"path":"2019/08/22/database/æ›´å¿«æ·çš„PG-PostGISè½¬æ¢ç«æ˜Ÿåæ ‡ç³»æ–¹æ³•/","link":"","permalink":"http://geocompass.github.io/2019/08/22/database/æ›´å¿«æ·çš„PG-PostGISè½¬æ¢ç«æ˜Ÿåæ ‡ç³»æ–¹æ³•/","excerpt":"","text":"æœ¬æ–‡ä½œè€…ï¼šyikouningæ³¨ï¼šè½¬è½½è¯·æ ‡æ˜å‡ºå¤„ å…³äºåæ ‡ç³»æˆ‘ä»¬é€šå¸¸ç”¨ç»çº¬åº¦æ¥è¡¨ç¤ºä¸€ä¸ªåœ°ç†ä½ç½®ï¼Œä½†æ˜¯ç”±äºä¸€äº›åŸå› ï¼Œæˆ‘ä»¬ä»ä¸åŒæ¸ é“å¾—åˆ°çš„ç»çº¬åº¦ä¿¡æ¯å¯èƒ½å¹¶ä¸æ˜¯åœ¨åŒä¸€ä¸ªåæ ‡ç³»ä¸‹ã€‚ é«˜å¾·åœ°å›¾ã€è…¾è®¯åœ°å›¾ä»¥åŠè°·æ­Œä¸­å›½åŒºåœ°å›¾ä½¿ç”¨çš„æ˜¯GCJ-02åæ ‡ç³» ç™¾åº¦åœ°å›¾ä½¿ç”¨çš„æ˜¯BD-09åæ ‡ç³» åº•å±‚æ¥å£(HTML5 Geolocationæˆ–iosã€å®‰å“API)é€šè¿‡GPSè®¾å¤‡è·å–çš„åæ ‡ä½¿ç”¨çš„æ˜¯WGS-84åæ ‡ç³» ä¸åŒçš„åæ ‡ç³»ä¹‹é—´å¯èƒ½æœ‰å‡ ååˆ°å‡ ç™¾ç±³çš„åç§»ï¼Œæ‰€ä»¥åœ¨å¼€å‘åŸºäºåœ°å›¾çš„äº§å“ï¼Œæˆ–è€…åšåœ°ç†æ•°æ®å¯è§†åŒ–æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ­£ä¸åŒåæ ‡ç³»ä¹‹é—´çš„åå·®ã€‚ WGS-84 - ä¸–ç•Œå¤§åœ°æµ‹é‡åæ ‡ç³»WGS-84ï¼ˆWorld Geodetic System, WGSï¼‰æ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„åæ ‡ç³»ï¼Œä¹Ÿæ˜¯ä¸–ç•Œé€šç”¨çš„åæ ‡ç³»ï¼ŒGPSè®¾å¤‡å¾—åˆ°çš„ç»çº¬åº¦å°±æ˜¯åœ¨WGS84åæ ‡ç³»ä¸‹çš„ç»çº¬åº¦ã€‚é€šå¸¸é€šè¿‡åº•å±‚æ¥å£å¾—åˆ°çš„å®šä½ä¿¡æ¯éƒ½æ˜¯WGS84åæ ‡ç³»ã€‚å¦‚å¤©åœ°å›¾ï¼Œosmåº•å›¾ç­‰ã€‚ GCJ-02 - å›½æµ‹å±€åæ ‡ç³»GCJ-02ï¼ˆG-Guojiaå›½å®¶ï¼ŒC-Cehuiæµ‹ç»˜ï¼ŒJ-Juå±€ï¼‰ï¼Œåˆè¢«ç§°ä¸ºç«æ˜Ÿåæ ‡ç³»ï¼Œæ˜¯ä¸€ç§åŸºäºWGS-84åˆ¶å®šçš„å¤§åœ°æµ‹é‡ç³»ç»Ÿï¼Œç”±ä¸­å›½å›½æµ‹å±€åˆ¶å®šã€‚æ­¤åæ ‡ç³»æ‰€é‡‡ç”¨çš„æ··æ·†ç®—æ³•ä¼šåœ¨ç»çº¬åº¦ä¸­åŠ å…¥éšæœºçš„åç§»ã€‚å¦‚è°·æ­Œåœ°å›¾ï¼ˆä¸­å›½åŒºï¼‰ï¼Œé«˜å¾·åœ°å›¾ï¼Œè…¾è®¯åœ°å›¾ç­‰ã€‚ BD-09 - ç™¾åº¦åæ ‡ç³»ç³»BD-09ï¼ˆBaidu, BDï¼‰æ˜¯ç™¾åº¦åœ°å›¾ä½¿ç”¨çš„åœ°ç†åæ ‡ç³»ï¼Œå…¶åœ¨GCJ-02åŸºç¡€ä¸Šåˆå¢åŠ äº†ä¸€æ¬¡åç§»ï¼Œç”¨æ¥ä¿æŠ¤ç”¨æˆ·éšç§ã€‚ä»ç™¾åº¦äº§å“ä¸­å¾—åˆ°çš„åæ ‡éƒ½æ˜¯BD-09åæ ‡ç³»ã€‚ å¦‚ä½•å®‰è£…PostgreSQLå®‰è£…PostGISæ‰©å±•å¤åˆ¶geoc-pg-coordtansform.sqlä¸­ä»£ç ï¼Œåœ¨æ•°æ®åº“æ‰§è¡Œgithubåœ°å€ï¼šhttps://github.com/geocompass/pg-coordtransform ç¤ºä¾‹GCJ02è½¬WGS84select geoc_gcj02towgs84(geom) from test_tableWGS84è½¬GCJ02select geoc_wgs84togcj02(geom) from test_tableWGS84è½¬BD09select geoc_wgs84tobd09(geom) from test_tableBD09è½¬WGS84select geoc_bd09towgs84(geom) from test_tableGCJ02è½¬BD09select geoc_gcj02tobd09(geom) from test_tableBD09è½¬GCJ02select geoc_bd09togcj02(geom) from test_table è½¬æ¢æ–¹æ³•åŸºäº PG+PostGIS è¿›è¡Œä¸‰ç§åæ ‡ç³»ä¹‹é—´çš„è½¬æ¢ï¼Œæ”¯æŒç‚¹ã€çº¿ã€é¢ã€å¤šç‚¹ã€å¤šçº¿ã€å¤šé¢ç­‰å„ç§éœ€æ±‚è¿›è¡Œäº’è½¬ geoc_gcj02towgs84ï¼šç«æ˜Ÿåæ ‡ç³»è½¬WGS84åæ ‡ç³»geoc_wgs84togcj02ï¼šWGS84åæ ‡ç³»è½¬ç«æ˜Ÿåæ ‡ç³»geoc_wgs84tobd09ï¼šWGS84åæ ‡ç³»è½¬ç™¾åº¦åæ ‡ç³»geoc_bd09towgs84ï¼šç™¾åº¦åæ ‡ç³»è½¬WGS84åæ ‡ç³»geoc_gcj02tobd09ï¼šç«æ˜Ÿåæ ‡ç³»è½¬ç™¾åº¦åæ ‡ç³»geoc_bd09togcj02ï¼šç™¾åº¦åæ ‡ç³»è½¬ç«æ˜Ÿåæ ‡ç³» æ³¨æ„äº‹é¡¹ä¼ å…¥çš„geometryå‚æ•°çš„ SRID å¿…é¡»æ˜¯ 4326 æˆ– 4490 ï¼Œå¦åˆ™è¿”å›nullã€‚ æ³¨æœ¬æ–‡å¦‚å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·åœ¨ github ä¸Š star ä¸€ä¸‹","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://geocompass.github.io/categories/æ•°æ®åº“/"}],"tags":[{"name":"PostgreSQL","slug":"PostgreSQL","permalink":"http://geocompass.github.io/tags/PostgreSQL/"},{"name":"PostGIS","slug":"PostGIS","permalink":"http://geocompass.github.io/tags/PostGIS/"}],"author":null},{"title":"å‰ç«¯å·¥å…·-è·ç¦»è½¬æ¢æ ‡é¢˜ç¼©å†™","slug":"frontend/DistanceTitle.tool","date":"2019-08-21T16:00:00.000Z","updated":"2020-05-21T01:10:32.115Z","comments":true,"path":"2019/08/22/frontend/DistanceTitle.tool/","link":"","permalink":"http://geocompass.github.io/2019/08/22/frontend/DistanceTitle.tool/","excerpt":"","text":"ä¸€ã€å…³äºå·¥å…·1.1 é—®é¢˜ åœ°å›¾å±•ç¤ºå‡ºæ¥çš„è·ç¦»ä¸ç¬¦åˆæˆ‘ä»¬å±•ç¤ºçš„è¦æ±‚ä¾‹å¦‚ï¼š0.01km 1.001km å¯¹åº”åœ°å›¾ä¿¡æ¯æ ‡é¢˜å±•ç¤ºå†…å®¹è¿‡é•¿ä¾‹å¦‚ï¼šåŒ—äº¬å¸‚æµ·æ·€åŒºè½¦é“æ²Ÿ1å·é’ä¸œå•†åŠ¡åŒº1.2 éœ€æ±‚ æˆ‘ä»¬å¯èƒ½æƒ³è¦çš„è·ç¦» 10m 1.0km æˆ‘ä»¬æƒ³è¦çš„æ ‡é¢˜ åŒ—äº¬å¸‚...é’ä¸œå•†åŠ¡åŒº1.3 åº”ç”¨const StrEllipsis = (str, len, starlen = 0, endlen = 0) =&gt; &#123; if (str.length &gt; len) &#123; return str.substr(0, starlen) + \"...\" + str.substr(str.length - endlen, str.length); &#125; return str;&#125;;const StrKm = (juli, fixednum = 3) =&gt; &#123; if (parseInt(juli) == juli) &#123; return juli + 'km' &#125; else &#123; let left = juli.toString().split(\".\")[0] let leftlast = left[left.length-1] if (left.length == 1 &amp;&amp; leftlast == 0) &#123; return juli.toFixed(fixednum)*(10 ** fixednum) + 'm' &#125; else &#123; return juli.toFixed(1) + 'km' &#125; &#125;&#125;export &#123; StrEllipsis, StrKm&#125; 1.4 ä½¿ç”¨import &#123;StrEllipsis, StrKm&#125; from ''StrEllipsis('åŒ—äº¬å¸‚æµ·æ·€åŒºè½¦é“æ²Ÿ1å·é’ä¸œå•†åŠ¡åŒº', 8, 3, 5) // 'åŒ—äº¬å¸‚...é’ä¸œå•†åŠ¡åŒº'StrEllipsis('åŒ—äº¬å¸‚æµ·æ·€åŒºè½¦é“æ²Ÿ1å·é’ä¸œå•†åŠ¡åŒº', 30) // 'åŒ—äº¬å¸‚æµ·æ·€åŒºè½¦é“æ²Ÿ1å·é’ä¸œå•†åŠ¡åŒº'StrKm(0.01) // 10mStrKm(1.01) // 1.0kmStrKm(0.123456) // 123m","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://geocompass.github.io/categories/å‰ç«¯/"}],"tags":[{"name":"å‰ç«¯å·¥å…·","slug":"å‰ç«¯å·¥å…·","permalink":"http://geocompass.github.io/tags/å‰ç«¯å·¥å…·/"},{"name":"åœ°å›¾å·¥å…·","slug":"åœ°å›¾å·¥å…·","permalink":"http://geocompass.github.io/tags/åœ°å›¾å·¥å…·/"}],"author":"LOUSANPANG"},{"title":"Egg.jsæ‰“åŒ…","slug":"backend/Egg-jsæ‰“åŒ…","date":"2019-08-21T12:31:05.000Z","updated":"2020-05-21T01:10:32.109Z","comments":true,"path":"2019/08/21/backend/Egg-jsæ‰“åŒ…/","link":"","permalink":"http://geocompass.github.io/2019/08/21/backend/Egg-jsæ‰“åŒ…/","excerpt":"","text":"æœ¬æ–‡ç”± @å°åˆ˜ åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ &nbsp; &nbsp; &nbsp; &nbsp;githubç¤ºä¾‹åœ°å€ï¼šhttps://github.com/MrSmallLiu/pkg-egg-example &nbsp; &nbsp; &nbsp; &nbsp;æ‰“åŒ…Node.jsä»£ç çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œæœ‰äº›å·¥å…·åœ¨æ‰“åŒ…æ—¶å°†è‡ªå·±å†™çš„ä»£ç æ‰“åŒ…ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶é…åˆnode_modulesä¸€èµ·ä½¿ç”¨ï¼Œæœ‰äº›å·¥å…·å°†å…¨éƒ¨ä»£ç æ‰“åŒ…ä¸ºäºŒè¿›åˆ¶ï¼Œä¸ªäººæ¯”è¾ƒåå‘äºå…¨éƒ¨æ‰“åŒ…ï¼Œä¾‹å¦‚pkgï¼Œéƒ½å¯ä»¥æ”¯æŒexpressã€koaç­‰æ¡†æ¶æ‰“åŒ…ï¼Œä½†æ˜¯å¯¹äºå°†koaæ¡†æ¶å°è£…åçš„Egg.jsæ¡†æ¶æ‰“åŒ…éƒ½æ²¡æœ‰è¯´æ˜å¦‚ä½•ä½¿ç”¨ï¼Œæˆ‘åœ¨å¤šæ¬¡å°è¯•åï¼ŒåŠ ä¹‹é˜…è¯»ä¸€éƒ¨åˆ†Egg.jsæºç åç»ˆäºåˆ©ç”¨pkgæˆåŠŸçš„æ‰“åŒ…ã€‚å¦‚ä¸‹ä»‹ç»å¦‚ä½•åˆ©ç”¨pkgæ‰“åŒ…Egg.jsä»£ç ã€‚ åˆ©ç”¨pkgæ‰“åŒ…Egg.jsä»£ç ï¼ˆä¸Šé¢å˜Ÿå›”äº†ä¸€å †åºŸè¯ï¼Œç»ˆäºæ­¥å…¥æ­£é¢˜ã€‚ï¼‰ pkgæ˜¯å°†æ•´ä¸ªå·¥ç¨‹æ‰“åŒ…ä¸ºä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒåŒ…æ‹¬nodeè¿è¡Œç¯å¢ƒä¸€èµ·æ‰“åŒ…ï¼Œéå¸¸æ–¹ä¾¿è¿ç§»ï¼Œè€Œä¸”ä¸éœ€è¦å®¢æˆ·ç¯å¢ƒé‡æ–°éƒ¨ç½²Node.jsä»¥åŠä¸‹è½½ç›¸å…³ä¾èµ–ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š å®‰è£…pkg(å‚è€ƒpkg) npm install pkg -g é…ç½®Egg.jsçš„publicè·¯å¾„ã€‚ç”±äºæ‰“åŒ…åä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯¹äºæŸäº›ç”¨æˆ·å°†å‰ç«¯ä»£ç æ”¾åœ¨Egg.jså·¥ç¨‹ç›®å½•ä¸‹çš„å°†ä¸èƒ½æ“ä½œï¼Œäºæ˜¯ä¿®æ”¹Egg.jsçš„publicè·¯å¾„é…ç½®åˆ°è¿è¡Œè·¯å¾„ä¸‹ï¼š // ä¿®æ”¹config/config.default.jsconfig.static = &#123; prefix: '/', dir: process.cwd() + '/public' &#125; é…ç½®Egg.jsçš„è¿è¡Œæ—¶è·¯å¾„ã€‚ç”±äºEgg.jsè¿è¡Œæ—¶ä¼šç”Ÿæˆrunæ–‡ä»¶å¤¹ä»¥åŠç›¸å…³æ–‡ä»¶ï¼Œè€Œpkgæ‰“åŒ…åä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸èƒ½åœ¨ç»§ç»­è¿›è¡Œå†™æ“ä½œï¼Œæ•…å°†rundiré…ç½®åˆ°è¿è¡Œè·¯å¾„ä¸‹ï¼š //ä¿®æ”¹config/config.default.jsconfig.rundir = process.cwd() + '/run' ä¿®æ”¹package.jsoné…ç½®pkgç›¸å…³å‚æ•°ï¼š å°†ä»£ç ä»¥é™æ€æ–‡ä»¶æ–¹å¼æ·»åŠ åˆ°æ‰“åŒ…ä¸­ï¼š //ä¿®æ”¹package.jsonï¼Œå¢åŠ pkgèŠ‚ç‚¹\"pkg\": &#123; \"assets\": [ \"./config/*.js\", \"./app.js\", \"./app/**/*.js\", \"./node_modules/nanoid/**/*.js\" //è¯¥è¡Œä¸ºå¿…é¡»æ·»åŠ ï¼Œç”±äºEgg.jsä½¿ç”¨nanoidåº“ï¼Œå…¶ä¸­ç”¨åˆ°ä¸€ä¸ªæ–‡ä»¶pkgæœªèƒ½è§£æï¼Œäºæ˜¯æ‰‹åŠ¨æ·»åŠ  ] &#125; é…ç½®pkgå…¥å£ï¼š // ä¿®æ”¹package.jsonï¼Œå¢åŠ binèŠ‚ç‚¹ï¼ŒæŒ‡å®šå…¥å£æ–‡ä»¶\"bin\": \"build.js\"// build.jsæ–‡ä»¶å†…å®¹require(__dirname + '/node_modules/egg-scripts/bin/egg-scripts.js') é…ç½®buildå‘½ä»¤ // ä¿®æ”¹package.json,åœ¨scriptsä¸‹å¢åŠ buildå‘½ä»¤\"scripts\": &#123; \"build\": \"pkg . --targets node8-linux-x64 --out-path /usr/dist --debug\" &#125;// --targets æŒ‡å®šnodeç‰ˆæœ¬ä¸º8ä»¥åŠlinux-x64// --out-path æŒ‡å®šæ‰“åŒ…åæ–‡ä»¶è¾“å‡ºè·¯å¾„// --debug æŒ‡å®šdebugæ¨¡å¼ç¼–è¯‘ å¼€å§‹æ‰“åŒ…// åˆæ¬¡æ‰“åŒ…æ—¶é—´è¾ƒé•¿ï¼Œåç»­æ‰“åŒ…pkgä¼šä½¿ç”¨nodeç¼“å­˜ï¼Œæé«˜æ‰“åŒ…æ•ˆç‡npm run build è¿è¡Œ./test_pkg start /snapshot/test_pkg --port=9001 --title=test_pkg// ./test_pkg æ‰“åŒ…åçš„äºŒè¿›åˆ¶æ–‡ä»¶// /snapshot/test_pkg å…¶ä¸­/snapshotä¸ºå¿…é¡»è·¯å¾„ï¼Œtest_pkgä¸ºå·¥ç¨‹ç›®å½•è·¯å¾„// --port --titleç­‰æ”¯æŒä¸å¹³å¸¸å¯åŠ¨æ—¶çš„ä»»æ„å‘½ä»¤å‚æ•° ä»¥ä¸Šå³å®Œæˆäº†Egg.jsçš„é¡¹ç›®æ‰“åŒ…å·¥ä½œï¼Œè¿™æ—¶å¯èƒ½æœ‰äººä¼šæƒ³åˆ°æ•°æ®åº“ç›¸å…³é…ç½®æ€ä¹ˆåŠ¨æ€æ¥æ”¹å˜å‘¢ï¼Ÿ C++ç¼–è¯‘çš„æ¨¡å—èƒ½å¦æ”¯æŒæ‰“åŒ…å‘¢ï¼Ÿï¼Œé‚£è¯·ç»§ç»­é˜…è¯»ã€‚ æ‰©å±•å¦‚ä½•æ”¯æŒåŠ¨æ€configå¯èƒ½æœ‰äººä¼šæƒ³åˆ°åˆ©ç”¨Egg.jsçš„å¯åŠ¨å‘¨æœŸæ¥åšå‘€ï¼Œé‚£ä¹ˆè¯´å¯¹äº†ï¼Œå°±æ˜¯åˆ©ç”¨configWillLoadå‘¨æœŸæ¥åšï¼Œåœ¨é¡¹ç›®ä¸­åˆ›å»ºapp.jsæ–‡ä»¶ï¼ˆå¦‚æœå·²ç»æœ‰çš„è¯·å¿½ç•¥ï¼‰ï¼Œåˆ©ç”¨å‘¨æœŸè¯»å–å¤–éƒ¨config.jsï¼Œç„¶åæ›¿æ¢config/config.default.jså†…å®¹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š // æ›¿æ¢sequelizeçš„storageï¼Œæ›¿æ¢dataPathè·¯å¾„var fs = require('fs');class AppBootHook &#123; constructor(app) &#123; this.app = app; &#125; configWillLoad() &#123; let customConfig = require(process.cwd() + '/config.js'); this.app.config.sequelize.storage = customConfig.dbPath; this.app.config.dataPath = customConfig.dataPath; &#125;&#125; module.exports = AppBootHook; æ³¨æ„Node.jså¤§éƒ¨åˆ†ç”¨æˆ·åº”è¯¥éƒ½ä¼šä½¿ç”¨sequelizeï¼Œè€Œå¯¹äºEgg.jsä½¿ç”¨egg-sequelizeï¼Œç”±äºegg-sequelizeå‘¨æœŸä¸­åŒ…å«agent.jsï¼Œå¯åŠ¨æ—¶è¯»å–config/config.default.jsï¼Œä¼šå¯¼è‡´å¯åŠ¨å¤±è´¥ï¼Œäºæ˜¯æœ¬äººä¿®æ”¹äº†ä¸€ç‰ˆegg-sequelize_pkgç”¨äºæ‰“åŒ…ä½¿ç”¨ï¼Œé™¤é…ç½®åç§°å·®å¼‚å¤–ä½¿ç”¨æ–¹æ³•ä¸egg-sequelizeä¸€è‡´ï¼Œä¸éœ€è¦ä¿®æ”¹åŸæœ‰ä»£ç ,å¦‚ä¸‹é…ç½®æ›´æ”¹å³å¯ // &#123;app_root&#125;/config/plugin.jsexports.sequelizePkg = &#123; enable: true, package: 'egg-sequelize_pkg',&#125;;// &#123;app_root&#125;/config/config.default.jsexports.sequelizePkg = &#123;&#125;; githubåœ°å€ä¸ºï¼šhttps://github.com/MrSmallLiu/egg-sequelize_pkg æ¬¢è¿æé—®é¢˜ï¼Œä¹Ÿæ¬¢è¿star C++æ¨¡å—å¼•å…¥pkgä»‹ç»å¯¹äºC++ç¼–è¯‘çš„.nodeæ¨¡å—ï¼Œåœ¨æ‰“åŒ…æ—¶ä¸ä¼šå°†å…¶æ‰“åŒ…è¿›äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ•…éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œç›®å‰æ˜¯ä¿®æ”¹æºç å¼•ç”¨ï¼ˆå„ä½æœ‰å¥½çš„åŠæ³•å¯ä»¥æ¨èç»™æˆ‘ï¼‰,ç„¶åå°†.nodeæ¨¡å—æ‹¿åˆ°è¿è¡Œç›®å½•ä¸‹ï¼š ä¿®æ”¹node_modulesä¸­å¯¹åº”æ¨¡å—æºç çš„requireäºŒè¿›åˆ¶æ–‡ä»¶çš„åœ°æ–¹ï¼Œå°†å…¶ä¿®æ”¹ä¸ºï¼š // ä»¥node-sqlite3ä¸ºä¾‹å°†lib/sqlite3.jsä¸­çš„var binding = require(binding_path);ä¿®æ”¹ä¸ºvar binding = require(process.cwd()+'/node_sqlite3.node') å°†æºç ä¸­çš„node_sqlite3.nodeæ–‡ä»¶æ‹·è´åˆ°ç¼–è¯‘åçš„è¿è¡Œç›®å½•ï¼Œå°†æ•´ä¸ªæ–‡ä»¶å¤¹zipå³å¯åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œ ä»¥ä¸Šä»‹ç»äº†å¦‚ä½•åˆ©ç”¨pkgè¿›è¡Œæ‰“åŒ…Egg.jså·¥ç¨‹ï¼Œå¦‚æœ‰ç–‘é—®å¯ä»¥è”ç³»ä½œè€…æˆ–è€…ä¸‹æ–¹è¯„è®ºï¼Œä¸€èµ·è®¨è®ºã€‚QQ: 1016817543 é‚®ç®±ï¼š1016817543@qq.com githubï¼šhttps://github.com/MrSmallLiu (æ¬¢è¿star)","categories":[{"name":"åç«¯","slug":"åç«¯","permalink":"http://geocompass.github.io/categories/åç«¯/"}],"tags":[{"name":"Egg.js","slug":"Egg-js","permalink":"http://geocompass.github.io/tags/Egg-js/"}],"author":"LH"},{"title":"å…³äºæˆ‘ä»¬","slug":"about/index","date":"2019-08-20T16:00:00.000Z","updated":"2020-05-21T01:10:32.108Z","comments":true,"path":"2019/08/21/about/index/","link":"","permalink":"http://geocompass.github.io/2019/08/21/about/index/","excerpt":"","text":"å…³äºæˆ‘ä»¬&emsp;&emsp;å›½ä¿¡å¸å—ï¼ˆåŒ—äº¬ï¼‰åœ°ç†ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸æ˜¯å›½å®¶åŸºç¡€åœ°ç†ä¿¡æ¯ä¸­å¿ƒåŸºäºä¿ƒè¿›åœ°ç†ä¿¡æ¯äº§ä¸šå‘å±•çš„å¤§å±€èƒŒæ™¯ï¼Œç»å›½å®¶æµ‹ç»˜åœ°ç†ä¿¡æ¯å±€æ‰¹å‡†ï¼Œäº2009å¹´12æœˆæˆç«‹çš„å…¨èµ„å›½æœ‰ä¼ä¸šã€‚ä¸ºæ¨è¿›äº§ä¸šå‘å±•åŠåœ°ç†ä¿¡æ¯ç¤¾ä¼šåŒ–æœåŠ¡ï¼Œå…¬å¸ç›¸ç»§æ³¨èµ„æˆç«‹äº†å¤©åœ°å›¾æœ‰é™å…¬å¸ã€å›½æµ‹å…´å›­ï¼ˆåŒ—äº¬ï¼‰æŠ•èµ„æœ‰é™å…¬å¸ã€‚ &emsp;&emsp;å…¬å¸â€œä»¥æ•°æ®è·å–ä¸å¤„ç†ä¸ºæ ¸å¿ƒã€ä»¥ä¿¡æ¯åŒ–ç³»ç»Ÿå»ºè®¾ä¸ºæŠ“æ‰‹ã€ä»¥ä¸šåŠ¡åŒ–äº§å“æœåŠ¡ä¸ºæ”¯æ’‘ã€ä»¥ç®¡ç†ä¸æŠ€æœ¯åˆ›æ–°ä¸ºæ‹“å±•â€ï¼Œç›¸ç»§ä¸ºæ°´åˆ©ã€æ°´ç”µã€æ–‡ç‰©ã€æ–‡åŒ–ã€å¤–äº¤ã€å…¬å®‰ã€æµ‹ç»˜ã€ç§‘æŠ€ã€æµ·å…³ã€æµ·äº‹ã€åœ°è´¨ã€åœ°éœ‡ã€çŸ³æ²¹ã€çŸ³åŒ–ã€æ–°é—»ã€å‡ºç‰ˆç­‰é¢†åŸŸæä¾›äº†ä¸ªæ€§åŒ–æœåŠ¡ã€‚ &emsp;&emsp;å‡­å€Ÿä¸æ–­æå‡çš„æŠ€æœ¯å®åŠ›ã€ä¸æ–­å®Œå–„çš„ä¼˜è´¨æœåŠ¡ï¼Œå…¬å¸ç°å·²æ‹¥æœ‰ç”²çº§æµ‹ç»˜èµ„è´¨ã€è½¯ä»¶ä¼ä¸šè®¤å®šã€è´¨é‡ç®¡ç†ä½“ç³»è®¤è¯ã€é«˜æ–°æŠ€æœ¯ä¼ä¸šã€è®¡ç®—æœºä¿¡æ¯ç³»ç»Ÿé›†æˆä¼ä¸šç­‰èµ„è´¨è¯ä¹¦ï¼Œå¹¶è£è·å¤šé¡¹è¡Œä¸šç§‘æŠ€ã€å·¥ç¨‹ã€åˆ›æ–°ç±»å¥–é¡¹ã€‚ &emsp;&emsp;å…¬å¸æ‹¥æœ‰ä¸€æ”¯å……æ»¡æ´»åŠ›ã€è¿›å–åˆ›æ–°çš„é«˜ç´ è´¨å›¢é˜Ÿï¼Œç§‰æ‰¿â€œå‡å¿ƒèšåŠ›ã€å¼€æ‹“åˆ›æ–°ã€ä¼˜è´¨æœåŠ¡ã€å’Œè°å‘å±•â€çš„å®—æ—¨ï¼Œä¸ºäº§ä¸šå¤§å‘å±•ã€å¤§ç¹è£æ·»ç –åŠ ç“¦ï¼Œä¸ºå…±åŒæ¨è¿›åœ°ç†ä¿¡æ¯æ›´å¥½åœ°æœåŠ¡å¤§å±€ã€æœåŠ¡ç¤¾ä¼šã€æœåŠ¡æ°‘ç”Ÿè€ŒåŠªåŠ›å¥‹æ–—ã€‚","categories":[{"name":"å›½ä¿¡å¸å—","slug":"å›½ä¿¡å¸å—","permalink":"http://geocompass.github.io/categories/å›½ä¿¡å¸å—/"}],"tags":[{"name":"å…³äºæˆ‘ä»¬","slug":"å…³äºæˆ‘ä»¬","permalink":"http://geocompass.github.io/tags/å…³äºæˆ‘ä»¬/"}],"author":"LOUSANPANG"},{"title":"å…³äºå†™ä½œ","slug":"write/write","date":"2019-08-20T16:00:00.000Z","updated":"2020-05-21T01:10:32.136Z","comments":true,"path":"2019/08/21/write/write/","link":"","permalink":"http://geocompass.github.io/2019/08/21/write/write/","excerpt":"","text":"ä¸€ã€å®‰è£…1.1 å®‰è£…å‰æ Node.js (Should be at least nodejs 6.9) Gitnpm install -g hexo-cli 1.2 ä¸‹è½½æºç ç›®å½•git clone https://github.com/geocompass/geocompass.github.io.git 1.3 å®‰è£…ä¾èµ–cd geocompass.github.iogit checkout hexonpm install 1.4 ç¼–ç cd source/_postscd bigdata/ #åœ¨å¯¹åº”é€‚åˆä½ çš„æ–‡ä»¶å¤¹ä¸‹è¾¹å»ºç«‹ åšå®¢æ–‡æ¡£hexo n [Your Blod Name]ç¼–ç æ ¼å¼è¯·å‚ç…§ 3.1 å…³äºå†™ä½œ 1.5 éƒ¨ç½²git pull # å»ºè®®æ¯æ¬¡éƒ½è¦æ›´æ–°å“¦ ä¹Ÿè®¸ä½ åœ¨ä¹¦å†™è¿‡ç¨‹ä¸­ï¼Œæœ‰äººå·²ç»æäº¤codeå•¦æ‰‹åŠ¨å°†å­ç›®å½•çš„ .git æ–‡ä»¶å¤åˆ¶ç²˜è´´åˆ° .deploy_git æ–‡ä»¶ä¸­hexo ghexo dåœ¨hexoåˆ†æ”¯æäº¤åˆ°è¿œç¨‹ä½ çš„ä»£ç ä¾‹å¦‚ï¼šgit add --agit commit -a -m 'Your name commit pages'git push äºŒã€å¸¸è§å‘½ä»¤2.1 å‘½ä»¤ hexo g == hexo generate #ç”Ÿæˆé™æ€æ–‡ä»¶ hexo s == hexo server #å¯åŠ¨æœ¬åœ°webæœåŠ¡ hexo d == hexo deploy #éƒ¨ç½²æ’­å®¢åˆ°è¿œç«¯ hexo clean #æ¸…é™¤ç¼“å­˜æ–‡ä»¶ hexo n == hexo new \"postName\" #æ–°å»ºæ–‡ç«  hexo n == hexo new page \"pageName\" #æ–°å»ºé¡µé¢ ä¸‰ã€å…³äºå†™ä½œ3.1 ä¹¦å†™--- title: å…³äºä¹¦å†™ date: 2019-08-21 categories: å‰ç«¯ author: LOUSANPANG tags: - React - Webpack cover_picture: /images/banner.jpg top: 0 --- &lt;!-- more --&gt; ### ä¸€ã€æ ‡é¢˜ä¸€ #### 1.1 æ ‡é¢˜1.1 è¯´æ˜ï¼š éœ€è¦æ³¨æ„ tags å’Œ categories çš„å†™æ³•ï¼Œä¸ç„¶é¦–é¡µä¸èƒ½æ­£ç¡®æ˜¾ç¤ºæ ‡ç­¾å’Œæ‘˜è¦ï¼› cover_picture æ–‡ç« å°é¢å›¾ï¼Œä¸å¡«é»˜è®¤æ˜¾ç¤º_config.ymlé…ç½®çš„å›¾ç‰‡ã€‚ cover_picture å»ºè®®æ·»åŠ ç¬¦åˆè‡ªå·±åšå®¢çš„ä¸»é¢˜å›¾ç‰‡ã€‚ å››ã€è¯¦ç»†æ–‡æ¡£Hexoä¸»é¢˜æ–‡æ¡£ äº”ã€å¸¸è§é—®é¢˜5.1 éƒ¨ç½²ä¸æˆåŠŸ è¯·ä¸¥æ ¼æŒ‰ç…§ 1.5 éƒ¨ç½² æµç¨‹æäº¤ä¸€ä¸‹ä½ çš„code, ä¹Ÿè®¸ä½ çš„é—®é¢˜ä¼šè§£å†³ã€‚ å…³äºä¸ºä»€ä¹ˆè¦ç§»åŠ¨ .gitæ–‡ä»¶ è¯·æŸ¥é˜…Hexoéƒ¨ç½²æŠ¥é”™Spawn failedåŠè§£å†³æ–¹æ¡ˆ éƒ¨ç½²æˆåŠŸåç½‘ç«™å¹¶ä¸æ˜¯æœ€æ–°çš„ï¼Œè¯·æ¸…æ¥šä¸€ä¸‹æµè§ˆå™¨ç¼“å­˜ï¼Œå†å°è¯•ã€‚ å…³äºä½ çš„åšå®¢å–ç”¨å›¾ç‰‡ï¼Œä½ å¯ä»¥å»ºç«‹è‡ªå·±çš„GitHubå›¾ç‰‡ä¾›åº”ä»“åº“ï¼Œä¾‹å¦‚GitHubå›¾ç‰‡ä¾›åº”åº“ æ›´å¤šé—®é¢˜è¯·æäº¤Issues ğŸ“","categories":[{"name":"å†™ä½œ","slug":"å†™ä½œ","permalink":"http://geocompass.github.io/categories/å†™ä½œ/"}],"tags":[{"name":"å†™ä½œ","slug":"å†™ä½œ","permalink":"http://geocompass.github.io/tags/å†™ä½œ/"}],"author":"LOUSANPANG"},{"title":"æ‰‹æŠŠæ‰‹æ•™ä½ ç”¨Mapboxçš„RoboSatåŸºäºæ·±åº¦å­¦ä¹ è‡ªåŠ¨æå–å»ºç­‘ç‰©","slug":"bigdata/robosat-buildings-training-step-by-step","date":"2019-08-16T16:00:00.000Z","updated":"2020-05-21T01:10:32.111Z","comments":true,"path":"2019/08/17/bigdata/robosat-buildings-training-step-by-step/","link":"","permalink":"http://geocompass.github.io/2019/08/17/bigdata/robosat-buildings-training-step-by-step/","excerpt":"","text":"åŸæ–‡é“¾æ¥ï¼šhttps://github.com/geocompass/robosat_buildings_training â€‹ æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ mapbox/robosat å·¥å…·ï¼ŒåŸºäºæ·±åº¦å­¦ä¹ è®­ç»ƒï¼Œä»å¸¸è§„çš„é¥æ„Ÿå½±åƒç“¦ç‰‡åœ°å›¾æœåŠ¡ä¸­è‡ªåŠ¨æå–å»ºç­‘ç‰©ã€‚åŒ…æ‹¬ç³»ç»Ÿå‡†å¤‡å·¥ä½œã€æ•°æ®å‡†å¤‡å·¥ä½œå’Œè®­ç»ƒä¸å»ºæ¨¡ã€‚é€šè¿‡æ ¹æ®æ–‡ç« çš„æè¿°ï¼Œå¯ä»¥å®Œæˆè®­ç»ƒä»»åŠ¡ã€‚ â€‹ å‚è€ƒæ–‡ç« ï¼šdaniel-j-h : RoboSat â¤ï¸ Tanzania æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•ä½¿ç”¨ RoboSat è‡ªåŠ¨æå–å»ºç­‘ç‰© 1. ç³»ç»Ÿå‡†å¤‡å·¥ä½œ 1.1 è®¾å¤‡åŠç³»ç»Ÿ 1.2 å®‰è£… Docker 1.3 åœ¨ Docker ä¸­å®‰è£… Robosat 2. æ•°æ®å‡†å¤‡å·¥ä½œ 2.1 å»ºç­‘ç‰©è½®å»“çŸ¢é‡æ•°æ® 2.2 è·å–å»ºç­‘ç‰©è½®å»“geojsonæ•°æ® 2.3 æå–è®­ç»ƒåŒºè¦†ç›–çš„ç“¦ç‰‡è¡Œåˆ—å· 2.4 ä¸‹è½½è®­ç»ƒåŒºé¥æ„Ÿå½±åƒç“¦ç‰‡ 2.5 åˆ¶ä½œè®­ç»ƒåŒºçŸ¢é‡æ•°æ®è’™ç‰ˆæ ‡è®° 3. è®­ç»ƒå’Œå»ºæ¨¡ 3.1 åˆ†é…è®­ç»ƒæ•°æ®ã€éªŒè¯æ•°æ®ã€è¯„ä¼°æ•°æ® 3.2 æƒé‡è®¡ç®— 3.3 å¼€å§‹è®­ç»ƒ 4. é¢„æµ‹ 4.1 å‡†å¤‡é¢„æµ‹åŒºåŸŸæ•°æ® 4.2 é¢„æµ‹å¾…æå–å»ºç­‘ç‰©æ¦‚ç‡ 4.3 é¢„æµ‹æ¦‚ç‡è½¬æ¢ä¸ºå»ºç­‘ç‰©æ©æ¨¡ 4.4 å»ºç­‘ç‰©æ©æ¨¡è½¬æ¢ä¸ºgeojson 4.5 åˆå¹¶æ©æ¨¡åˆ†å‰²çš„ geojson â€‹ å‚è€ƒæ–‡ç« ï¼šdaniel-j-h : RoboSat â¤ï¸ Tanzania 1. ç³»ç»Ÿå‡†å¤‡å·¥ä½œ1.1 è®¾å¤‡åŠç³»ç»Ÿ å‡†å¤‡ä¸€å°å®‰è£… Linux æˆ– MacOS ç³»ç»Ÿçš„æœºå™¨ï¼Œå¯ä»¥æ˜¯ CentOSã€Ubuntu æˆ– MacOSã€‚æœºå™¨å¯ä»¥æ˜¯å®ä½“æœºï¼Œä¹Ÿå¯ä»¥æ˜¯ VMware è™šæ‹Ÿæœºã€‚ 1.2 å®‰è£… Docker åœ¨æœºå™¨ä¸­å®‰è£… Dockerï¼Œä¸å»ºè®®æ˜¯ Windows ç‰ˆ Dockerã€‚MacOS å®‰è£… Docker ï¼ŒCentOS å®‰è£… Docker 1.3 åœ¨ Docker ä¸­å®‰è£… Robosat Robosat çš„ Docker Hubã€‚ â€‹ å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼å®‰è£… Robosatï¼š ä½¿ç”¨ CPU å®¹å™¨ï¼š docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu --help ä½¿ç”¨ GPU å®¹å™¨ï¼ˆä¸»æœºä¸Šéœ€è¦ nvidia-dockerï¼‰ï¼š docker run --runtime=nvidia -it --rm -v $PWD:/data --ipc=host mapbox/robosat:latest-gpu train --model /data/model.toml --dataset /data/dataset.toml --workers 4 2. æ•°æ®å‡†å¤‡å·¥ä½œ2.1 å»ºç­‘ç‰©è½®å»“çŸ¢é‡æ•°æ®â€‹ å·²æœ‰çš„å»ºç­‘ç‰©è½®å»“çŸ¢é‡æ•°æ®ç”¨æ¥ä½œä¸ºå»ºç­‘ç‰©æå–çš„è®­ç»ƒæ•°æ®æºã€‚å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼è·å–ï¼š OSM æ•°æ®æºï¼Œå¯ä»¥åœ¨ geofabrik è·å–ï¼Œé€šè¿‡ osmium å’Œ robosat å·¥å…·è¿›è¡Œå¤„ç†ã€‚ è‡ªæœ‰æ•°æ®æºã€‚é€šè¿‡ QGIS æˆ– ArcMap ç­‰å·¥å…·ï¼ŒåŠ è½½é¥æ„Ÿå½±åƒåº•å›¾ï¼Œæè¿°çš„å»ºç­‘ç‰©è½®å»“ Shapefile æ•°æ®ã€‚ â€‹ æœ¬æ–‡ä½¿ç”¨ç¬¬äºŒç§æ•°æ®æ¥æºï¼Œå¹¶å·²å¼€æºæ•°æ®æºï¼Œå¼€æºçš„çŸ¢é‡æ•°æ®è¦†ç›–å¦é—¨æ ¸å¿ƒåŒºã€‚ â€‹ è€ƒè™‘åˆ°ä½¿ç”¨ä¸ªäººç”µè„‘æ²¡æœ‰ CUDA åŠ é€Ÿè®­ç»ƒæˆæœ¬è¾ƒé«˜ï¼Œæœ¬æ–‡ä½¿ç”¨ buia_xiamen_min_shpï¼ŒåŒ…å«å¦é—¨æ ¸å¿ƒåŒºéƒ¨åˆ†åŒºåŸŸï¼Œå…± 5679 ä¸ªå»ºç­‘ç‰©è½®å»“ã€‚åœ¨ Docker é…ç½®ä¸º å¤„ç†å™¨(CPU) 4 æ ¸ã€å†…å­˜(RAM)16GBã€äº¤æ¢å†…å­˜(Swap)3GB æ—¶ï¼Œè®­ç»ƒæ—¶é—´å¤§çº¦ 2.5 å°æ—¶ã€‚ 2.2 è·å–å»ºç­‘ç‰©è½®å»“ geojson æ•°æ®â€‹ é€šè¿‡åœ¨çº¿å·¥å…· mapshaperï¼Œå°† shapefile æ•°æ®è½¬æ¢ä¸º geojson æ•°æ®ã€‚ 2.3 æå–è®­ç»ƒåŒºè¦†ç›–çš„ç“¦ç‰‡è¡Œåˆ—å·â€‹ ä½¿ç”¨ robosat çš„ cover å‘½ä»¤ï¼Œå³å¯è·å–å½“å‰è®­ç»ƒåŒºçŸ¢é‡æ•°æ®è¦†ç›–çš„ç“¦ç‰‡è¡Œåˆ—å·ï¼Œå¹¶ä½¿ç”¨ csv æ–‡ä»¶å­˜å‚¨ã€‚ docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu cover --zoom 18 /data/buildings.json /data/buildings.tiles cover å‘½ä»¤çš„å‚æ•°ä»‹ç»ï¼š usage: ./rs cover [-h] --zoom ZOOM features out positional arguments: features path to GeoJSON features out path to csv file to store tiles in optional arguments: -h, â€“help show this help message and exit --zoom ZOOM zoom level of tiles (default: None) è¿™é‡Œæ˜¯è·å–åœ¨ 18 çº§ä¸‹è®­ç»ƒåŒºè¦†ç›–çš„ç“¦ç‰‡è¡Œåˆ—å·ã€‚18 çº§æ˜¯å›½å†…åœ°å›¾é€šç”¨çš„æœ€å¤§çº§åˆ«ï¼Œå¦‚æœæœ‰å›½å¤–æ›´æ¸…æ™°æ•°æ®æºï¼Œå¯è®¾ç½®æ›´é«˜åœ°å›¾çº§åˆ«ã€‚ â€‹ cover å·¥å…·å¯¹è®­ç»ƒåŒºçŸ¢é‡æ•°æ®è®¡ç®—çš„ç“¦ç‰‡è¡Œåˆ—å·ä½¿ç”¨çš„æ˜¯é€šç”¨çš„ WGS84-&gt;Web å¢¨å¡æ‰˜æŠ•å½±åæ ‡ç³»ã€‚ å°çŸ¥è¯†ï¼š $PWD:/data æ˜¯å°†å½“å‰è·¯å¾„æ˜ å°„ä¸º docker ä¸­çš„ /data è·¯å¾„ã€‚ åœ¨æ–°ç‰ˆ robosat çš„ docker å®‰è£…åŒ…ä¸­ï¼Œå°† ./rs å‘½ä»¤è¡Œå·¥å…·å¯¹åº”ä¸ºdocker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu å‘½ä»¤ã€‚ docker ç‰ˆ robosat ï¼Œä»¥å‘½ä»¤è¡Œæ–¹å¼æ‰§è¡Œï¼Œæ— æ³•ç”Ÿæˆç±»ä¼¼ nginx çš„ docker æœåŠ¡ï¼Œæ‰€ä»¥æ‰§è¡Œå®Œæˆåç«‹å³é”€æ¯äº† docker çš„ containerã€‚ 2.4 ä¸‹è½½è®­ç»ƒåŒºé¥æ„Ÿå½±åƒç“¦ç‰‡â€‹ ä½¿ç”¨ robosat çš„ download å·¥å…·ï¼Œå³å¯è·å–å½“å‰è®­ç»ƒåŒºçŸ¢é‡æ•°æ®è¦†ç›–çš„é¥æ„Ÿå½±åƒï¼Œä¸‹è½½çš„ç“¦ç‰‡é€šè¿‡ 2.3 èŠ‚ä¸­çš„buildings.tiles ç¡®å®šã€‚ docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu download http://ditu.google.cn/maps/vt/lyrs=s&amp;x=&#123;x&#125;&amp;y=&#123;y&#125;&amp;z=&#123;z&#125; /data/buildings.tiles /data/tiles â€‹ download å‘½ä»¤çš„å‚æ•°ä»‹ç»ï¼š usage: ./rs download [-h] [--ext EXT] [--rate RATE] url tiles out positional arguments: url endpoint with {z}/{x}/{y} variables to fetch image tiles from tiles path to .csv tiles file out path to slippy map directory for storing tiles optional arguments: -h, â€“help show this help message and exit --ext EXT file format to save images in (default: webp) --rate RATE rate limit in max. requests per second (default: 10) â€‹ è¿™é‡Œä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„ Web å¢¨å¡æ‰˜æŠ•å½±çš„ï¼ˆWGS84 åæ ‡ç³»ï¼‰é¥æ„Ÿå½±åƒæ•°æ®æºï¼š è°·æ­Œåœ°å›¾ CN å½±åƒï¼šhttp://ditu.google.cn/maps/vt/lyrs=s&amp;x={x}&amp;y={y}&amp;z={z} å¤©åœ°å›¾å½±åƒï¼šhttps://t4.tianditu.gov.cn/DataServer?T=img_w&amp;x={x}&amp;y={y}&amp;l={z}&amp;tk=2ce94f67e58faa24beb7cb8a09780552 ArcGIS Online å½±åƒï¼šhttps://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x} MapBox å½±åƒï¼šhttps://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}@2x.png?sku=101KOLcQaDwG1&amp;access_token=[token] â€‹ å‡ ç§é¥æ„Ÿå½±åƒæ•°æ®æºçš„æ¯”è¾ƒï¼š ä»è®¿é—®é€Ÿåº¦æ¥çœ‹ï¼Œå¤©åœ°å›¾&gt;è°·æ­Œ&gt;ArcGIS&gt;Mapboxã€‚ ä»é¥æ„Ÿå½±åƒçš„è´¨é‡æ¥è¯´ï¼Œæ€»ä½“æ¥è¯´ï¼š åŸå¸‚åœ°åŒºï¼šè°·æ­Œ=ArcGIS&gt;å¤©åœ°å›¾&gt;Mapbox å†œæ‘åœ°å›¾ï¼šè°·æ­Œ&gt;å¤©åœ°å›¾&gt;ArcGIS&gt;Mapbox å±‚çº§è¦†ç›–ï¼šè°·æ­Œ&gt;å¤©åœ°å›¾&gt;ArcGIS&gt;Mapbox â€‹ ä¸åŒå½±åƒæ•°æ®æºçš„è´¨é‡ä¸èƒ½ä¸€æ¦‚è€Œè®ºï¼Œç”±äºä¼ æ„Ÿå™¨ä¸åŒã€è¿‡å¢ƒæ—¶é—´ä¸åŒç­‰å› ç´ ï¼Œä¸åŒåœ°åŒºçš„å½±åƒæ•°æ®æºè´¨é‡å‡ä¸åŒï¼Œå»ºè®®ä½¿ç”¨ QGIS åŠ è½½è®­ç»ƒåŒºä½ç½®çš„å½±åƒå¯¹æ¯”é€‰æ‹©ã€‚ 2.5 åˆ¶ä½œè®­ç»ƒåŒºçŸ¢é‡æ•°æ®è’™ç‰ˆæ ‡è®°â€‹ ä½¿ç”¨ 2.2 èŠ‚ä¸­åˆ¶ä½œçš„ geojson æ•°æ®ï¼Œé€šè¿‡ robosat çš„ rasterize å·¥å…·å¯åˆ¶ä½œè®­ç»ƒåŒºçŸ¢é‡æ•°æ®çš„è’™ç‰ˆæ ‡è®°æ•°æ®ã€‚è’™ç‰ˆæ ‡è®°æ•°æ®ä¸ç“¦ç‰‡æ•°æ®ä¸€ä¸€ç›¸å¯¹åº”ï¼Œä½¿ç”¨åŒæ ·çš„ buildings.tiles ç“¦ç‰‡åˆ—è¡¨äº§ç”Ÿã€‚ docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu rasterize --dataset /data/dataset-building.toml --zoom 18 --size 256 /data/buildings.json /data/buildings.tiles /data/masks â€‹ rasterise å‘½ä»¤çš„å‚æ•°ä»‹ç»ï¼š usage: ./rs rasterize [-h] --dataset DATASET --zoom ZOOM [--size SIZE] features tiles out positional arguments: features path to GeoJSON features file tiles path to .csv tiles file out directory to write converted images optional arguments:-h, --help show this help message and exit--dataset DATASET path to dataset configuration file (default: None)--zoom ZOOM zoom level of tiles (default: None)--size SIZE size of rasterized image tiles in pixels (default: 512) è¿™é‡Œä½¿ç”¨åˆ°äº† dataset-building.toml é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­é…ç½®äº†ç“¦ç‰‡åœ°å›¾è·¯å¾„ã€åˆ†ç±»æ–¹å¼ã€è’™ç‰ˆæ ‡è®°çš„é¢œè‰²ç­‰ä¿¡æ¯ã€‚ç¤ºä¾‹é…ç½®å¯ä»¥æŸ¥çœ‹å®˜æ–¹ç¤ºä¾‹æ–‡ä»¶ dataset-parking.toml ã€‚æœ¬è®­ç»ƒä¸­ç”¨åˆ°çš„ dataset-building.toml çš„é…ç½®å†…å®¹å¦‚ä¸‹ï¼š # Configuration related to a specific dataset.# For syntax see: https://github.com/toml-lang/toml#table-of-contents# Dataset specific common attributes.[common] # The slippy map dataset's base directory. dataset = '/Users/wucan/Document/robosat/tiles/' # Human representation for classes. classes = ['background', 'buildings'] # Color map for visualization and representing classes in masks. # Note: available colors can be found in `robosat/colors.py` colors = ['denim', 'orange'] â€‹ é…ç½®æ–‡æ¡£ä¸­ï¼Œæœ€é‡è¦çš„æ˜¯é…ç½® dataset ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€æ­¥ä¸­ä¸‹è½½çš„é¥æ„Ÿå½±åƒç“¦ç‰‡è·¯å¾„ã€‚åˆ¶ä½œçš„è’™ç‰ˆæ ‡è®°æ•ˆæœå¦‚ä¸‹å›¾ã€‚ â€‹ è‡³æ­¤ï¼Œè®­ç»ƒå’Œå»ºæ¨¡æ‰€éœ€çš„ç“¦ç‰‡å’Œè’™ç‰ˆæ ‡è®°å·²ç»å…¨éƒ¨å‡†å¤‡å®Œï¼Œåˆ†åˆ«åœ¨ tiles å’Œ masks ç›®å½•ä¸­ã€‚ 3. è®­ç»ƒå’Œå»ºæ¨¡3.1 åˆ†é…è®­ç»ƒæ•°æ®ã€éªŒè¯æ•°æ®ã€è¯„ä¼°æ•°æ®â€‹ RoboSat åˆ†å‰²æ¨¡å‹æ˜¯ä¸€ä¸ªå®Œå…¨å·ç§¯çš„ç¥ç»ç½‘ç»œï¼Œéœ€è¦å°†ä¸Šä¸€æ­¥å‡†å¤‡å¥½çš„æ•°æ®é›†æ‹†åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«ä¸ºè®­ç»ƒæ•°æ®é›† ã€éªŒè¯æ•°æ®é›†ã€è¯„ä¼°æ•°æ®é›†ï¼Œæ¯”ä¾‹åˆ†åˆ«ä¸º 80%ã€10%ã€10%ã€‚æ¯ä¸€éƒ¨åˆ†çš„æ•°æ®é›†ä¸­ï¼Œéƒ½åŒ…å«å½±åƒç“¦ç‰‡å’Œè’™ç‰ˆæ ‡è®°ç“¦ç‰‡ã€‚ è®­ç»ƒæ•°æ®é›†ï¼ša training dataset on which we train the model on éªŒè¯æ•°æ®é›†ï¼ša validation dataset on which we calculate metrics on after training è¯„ä¼°æ•°æ®é›†ï¼ša hold-out evaluation dataset if you want to do hyper-parameter tuning å°†æ­¥éª¤ 2 ä¸­çš„æ•°æ®è¿›è¡Œéšæœºåˆ†é…çš„è¿‡ç¨‹éå¸¸ç®€å•ï¼š æ–°å»ºä¸‰ä¸ª csv æ–‡ä»¶ï¼š csv_training.tiles ã€csv_validation.tilesã€ csv_evaluation.tiles å°† buildings.tiles ä¸­çš„ç“¦ç‰‡åˆ—è¡¨éšæœºæŒ‰ 80%ã€10%ã€10% æ¯”ä¾‹è¿›è¡Œæ‹·è´ä¸ç²˜è´´ã€‚æ³¨æ„ä¸‰ä¸ªæ–‡ä»¶é—´çš„ç“¦ç‰‡åˆ—è¡¨å†…å®¹ä¸èƒ½é‡å¤ã€‚ â€‹ ä½¿ç”¨ RoboSat ä¸­çš„ subset å‘½ä»¤ï¼Œå°† tiles å’Œ masks ä¸­çš„ç“¦ç‰‡å’Œè’™ç‰ˆæŒ‰ç…§ä¸Šé¢ä¸‰ä¸ª csv æ–‡ä»¶çš„ç“¦ç‰‡åˆ—è¡¨åˆ†é…è¿›è¡Œç»„ç»‡å½±åƒç“¦ç‰‡å’Œè’™ç‰ˆæ ‡è®°æ•°æ®ã€‚ # å‡†å¤‡è®­ç»ƒæ•°æ®é›†docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/tiles/ /data/csv_training.tiles /data/dataset/training/imagesdocker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/masks/ /data/csv_training.tiles /data/dataset/training/labels# å‡†å¤‡éªŒè¯æ•°æ®é›†docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/tiles/ /data/csv_validation.tiles /data/dataset/validation/imagesdocker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/masks/ /data/csv_validation.tiles /data/dataset/validation/labels# å‡†å¤‡è¯„ä¼°æ•°æ®é›†docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/tiles/ /data/csv_evaluation.tiles /data/dataset/evaluation/imagesdocker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/masks/ /data/csv_evaluation.tiles /data/dataset/evaluation/labels â€‹ subset å‘½ä»¤çš„å‚æ•°ä»‹ç»ï¼š usage: ./rs subset [-h] images tiles out positional arguments: images directory to read slippy map image tiles from for filtering tiles csv to filter images by out directory to save filtered images to optional arguments: -h, --help show this help message and exit â€‹ åˆ†ç±»å®Œæˆä»¥åï¼Œå°†ä¼šç”Ÿæˆ /data/dataset ç›®å½•ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š dataset| training| | images| | labels| validataion| | images| | labels| evaluation| | images| | labels 3.2 æƒé‡è®¡ç®—â€‹ å› ä¸ºå‰æ™¯å’ŒèƒŒæ™¯åœ¨æ•°æ®é›†ä¸­åˆ†å¸ƒä¸å‡ï¼Œå¯ä»¥ä½¿ç”¨ RoboSat ä¸­çš„ weights å‘½ä»¤ï¼Œåœ¨æ¨¡å‹è®­ç»ƒä¹‹å‰è®¡ç®—ä¸€ä¸‹æ¯ä¸ªç±»çš„åˆ†å¸ƒã€‚ docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu weights --dataset /data/dataset-building-weights.toml â€‹ weights å‘½ä»¤çš„å‚æ•°å¦‚ä¸‹ï¼š usage: ./rs weights [-h] --dataset DATASET optional arguments: -h, --help show this help message and exit --dataset DATASET path to dataset configuration file (default: None) â€‹ è¿™é‡Œï¼Œç”¨åˆ°äº†dataset-building-weights.toml ï¼Œæ˜¯å°†å‰é¢æ­¥éª¤ä¸­çš„ dataset-building.toml ç“¦ç‰‡è·¯å¾„ä¿®æ”¹ä¸ºåŒ…å«è®­ç»ƒæ•°æ®é›† dataset çš„è·¯å¾„ã€‚æ‰§è¡Œæƒé‡è®¡ç®—å‘½ä»¤åï¼Œå¾—åˆ°æƒé‡ä¸ºï¼švalues = [1.653415, 5.266637] ã€‚å°†å…¶è¿½åŠ åˆ° dataset-building-weights.toml æ–‡ä»¶ä¸­ï¼Œç»“æœå¦‚ä¸‹ã€‚ # Configuration related to a specific dataset.# For syntax see: https://github.com/toml-lang/toml#table-of-contents# Dataset specific common attributes.[common] # The slippy map dataset&apos;s base directory. dataset = &apos;/data/dataset&apos; # Human representation for classes. classes = [&apos;background&apos;, &apos;buildings&apos;] # Color map for visualization and representing classes in masks. # Note: available colors can be found in `robosat/colors.py` colors = [&apos;denim&apos;, &apos;orange&apos;]# Dataset specific class weights computes on the training data.# Needed by &apos;mIoU&apos; and &apos;CrossEntropy&apos; losses to deal with unbalanced classes.# Note: use `./rs weights -h` to compute these for new datasets.[weights] values = [1.653415, 5.266637] 3.3 å¼€å§‹è®­ç»ƒâ€‹ RoboSat ä½¿ç”¨ train å‘½ä»¤è¿›è¡Œè®­ç»ƒã€‚ docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu train --model /data/model-unet.toml --dataset /data/dataset-building-weights.toml â€‹ train å‘½ä»¤çš„å‚æ•°å¦‚ä¸‹ï¼š usage: ./rs train [-h] --model MODEL --dataset DATASET [--checkpoint CHECKPOINT] [--resume RESUME] [--workers WORKERS] positional arguments: --model MODEL path to model configuration file (default: None) --dataset DATASET path to dataset configuration file (default: None) optional arguments: -h, `â€“help show this help message and exit --checkpoint CHECKPOINT path to a model checkpoint (to retrain) (default: None) --resume RESUME resume training or fine-tuning (if checkpoint) (default: False) --workers WORKERS number of workers pre-processi ng images (default: 0) â€‹ è¿™é‡Œå¤šäº†ä¸€ä¸ªé…ç½®æ–‡ä»¶ model-unet.toml ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸»è¦ç”¨æ¥é…ç½®è®­ç»ƒè¿‡ç¨‹ä¸­çš„å‚æ•°ï¼ŒåŒ…æ‹¬æ˜¯å¦å¯ç”¨ CUDA ã€è®­ç»ƒæ‰¹æ¬¡å¤§å°ã€å½±åƒç“¦ç‰‡çš„åƒç´ å¤§å°ã€æ£€æŸ¥ç‚¹å­˜å‚¨è·¯å¾„ç­‰ã€‚å®˜æ–¹ç»™å‡ºäº†ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®æœ¬å®éªŒçš„æƒ…å†µåšäº†ä¿®æ”¹å¦‚ä¸‹ï¼Œé…ç½®å¦‚ä¸‹ã€‚ # Configuration related to a specific model.# For syntax see: https://github.com/toml-lang/toml#table-of-contents# Model specific common attributes.[common] # Use CUDA for GPU acceleration. cuda = false # Batch size for training. batch_size = 2 # Image side size in pixels. image_size = 256 # Directory where to save checkpoints to during training. checkpoint = &apos;/data/checkpoint/&apos;# Model specific optimization parameters.[opt] # Total number of epochs to train for. epochs = 10 # Learning rate for the optimizer. lr = 0.01 # Loss function name (e.g &apos;Lovasz&apos;, &apos;mIoU&apos; or &apos;CrossEntropy&apos;) loss = &apos;Lovasz&apos; â€‹ RoboSat ä¼šè¿›è¡Œå¤šæ¬¡è¿­ä»£è®­ç»ƒï¼Œæ¯æ¬¡è¿­ä»£è®­ç»ƒéƒ½ä¼šä¿å­˜æ£€æŸ¥ç‚¹(checkpoint)å’Œå„é¡¹æŒ‡æ ‡ç­‰ã€‚å…¶ä¸­ï¼Œè®­ç»ƒæ—¥å¿—ä¾‹å¦‚ï¼š --- Hyper Parameters on Dataset: /data/dataset ---Batch Size: 2Image Size: 256Learning Rate: 0.0001Loss function: LovaszWeights : [1.644471, 5.409126]---Epoch: 1/10Train loss: 0.3190, mIoU: 0.410, buildings IoU: 0.017, MCC: -0.002Validate loss: 0.3171, mIoU: 0.405, buildings IoU: 0.000, MCC: nan...Epoch: 10/10Train loss: 0.2693, mIoU: 0.528, buildings IoU: 0.229, MCC: 0.330Validate loss: 0.2880, mIoU: 0.491, buildings IoU: 0.167, MCC: 0.262 â€‹ å¯ä»¥é€‰æ‹©æœ€å¥½çš„è®­ç»ƒç»“æœï¼Œä¿ç•™å…¶æ£€æŸ¥ç‚¹( checkpoint-***.pth )ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ predictã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹æ•ˆæœæœ€å¥½ã€‚ 4. é¢„æµ‹4.1 å‡†å¤‡é¢„æµ‹åŒºåŸŸæ•°æ®â€‹ RoboSat ä»…æ”¯æŒä»å½±åƒç“¦ç‰‡ä¸­æå–å»ºç­‘ç‰©ï¼Œä¸æ”¯æŒä»ä»»æ„çš„ jpg å›¾ç‰‡ä¸­æå–ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡é¢„æµ‹åŒºåŸŸçš„ç“¦ç‰‡æ•°æ®ã€‚ â€‹ é€šè¿‡ geojson.io ç»˜åˆ¶æƒ³è¦æå–å»ºç­‘ç‰©çš„èŒƒå›´ï¼Œä½¿ç”¨çŸ©å½¢æ¡†å³å¯ã€‚å°†è‡ªåŠ¨ç”Ÿæˆçš„ geojson ä¿å­˜ä¸º predict_test.jsonã€‚ â€‹ é€šè¿‡ 2.3 ä¸­çš„ cover å‘½ä»¤ï¼Œè·å–å¾…æå–èŒƒå›´çš„ç“¦ç‰‡åˆ—è¡¨ csv æ–‡ä»¶ï¼Œä¿å­˜åˆ° buildings_predict.tiles æ–‡ä»¶ä¸­ã€‚ docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu cover --zoom 18 /data/shp_data/predict_test.json /data/buildings_predict.tiles â€‹ ä½¿ç”¨ 2.4 ä¸­çš„ download å‘½ä»¤ï¼Œä¸‹è½½å¾…æå–èŒƒå›´çš„å½±åƒç“¦ç‰‡ï¼Œä¿å­˜åˆ° images_predict æ–‡ä»¶å¤¹ä¸­ã€‚ docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu download https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/&#123;z&#125;/&#123;y&#125;/&#123;x&#125; /data/buildings_predict.tiles /data/images_predict 4.2 é¢„æµ‹å¾…æå–å»ºç­‘ç‰©æ¦‚ç‡â€‹ ä½¿ç”¨ä¿å­˜çš„æ£€æŸ¥ç‚¹æ¥ï¼ˆcheckpintï¼‰é¢„æµ‹å›¾åƒä¸­æ¯ä¸ªåƒç´ çš„åˆ†å‰²æ¦‚ç‡ï¼Œè¿™äº›åˆ†å‰²æ¦‚ç‡è¡¨ç¤ºæ¯ä¸ªåƒç´ æ˜¯å»ºç­‘ç‰©è¿˜æ˜¯èƒŒæ™¯çš„å¯èƒ½æ€§ï¼Œç„¶åå¯ä»¥å°†è¿™äº›æ¦‚ç‡è½¬æ¢ä¸ºç¦»æ•£çš„åˆ†å‰²æ©æ¨¡ã€‚ â€‹ é€šè¿‡ RoboSat çš„ predict å‘½ä»¤ï¼Œå°†å¾…é¢„æµ‹åŒºåŸŸçš„å»ºç­‘ç‰©ï¼ˆ images_predict ï¼‰æå–ä¸ºåˆ†å‰²æ¦‚ç‡ï¼ˆpredict_segmentation-probabilitiesï¼‰ã€‚ docker run -it -d --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu predict --tile_size 256 --model /data/model-unet.toml --dataset /data/dataset-building.toml --checkpoint /data/checkpoint/checkpoint-00010-of-00010.pth /data/images_predict /data/predict_segmentation-probabilities â€‹ predict å‘½ä»¤çš„å‚æ•°å¦‚ä¸‹ï¼š usage: ./rs predict [-h] [--batch_size BATCH_SIZE] --checkpoint CHECKPOINT [--overlap OVERLAP] --tile_size TILE_SIZE [--workers WORKERS] --model MODEL --dataset DATASET tiles probs positional arguments: tiles directory to read slippy map image tiles from probs directory to save slippy map probability masks to optional arguments: -h, --help show this help message and exit --batch_size BATCH_SIZE images per batch (default: 1) --checkpoint CHECKPOINT model checkpoint to load (default: None) --overlap OVERLAP tile pixel overlap to predict on (default: 32) --tile_size TILE_SIZE tile size for slippy map tiles (default: None) --workers WORKERS number of workers pre-processing images (default: 0) --model MODEL path to model configuration file (default: None) --dataset DATASET path to dataset configuration file (default: None) 4.3 é¢„æµ‹æ¦‚ç‡è½¬æ¢ä¸ºå»ºç­‘ç‰©æ©æ¨¡â€‹ é€šè¿‡ RoboSat çš„ masks å‘½ä»¤ï¼Œå°†ä¸Šä¸€æ­¥ä¸­çš„å»ºç­‘ç‰©é¢„æµ‹æ¦‚ç‡ç»“æœè½¬æ¢ä¸ºå»ºç­‘ç‰©æ©æ¨¡ï¼ˆmasksï¼‰ï¼Œä¿å­˜åˆ° predict_segmentation-masks æ–‡ä»¶å¤¹ä¸­ã€‚ docker run -it -d --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu masks /data/predict_segmentation-masks /data/predict_segmentation-probabilities usage: ./rs masks [-h] [--weights WEIGHTS [WEIGHTS ...]] masks probs [probs ...] positional arguments: masks slippy map directory to save masks to probs slippy map directories with class probabilities optional arguments: -h, --help show this help message and exit --weights WEIGHTS [WEIGHTS ...] weights for weighted average soft-voting (default:None) 4.4 å»ºç­‘ç‰©æ©æ¨¡è½¬æ¢ä¸º geojsonâ€‹ é€šè¿‡ RoboSat çš„ features å‘½ä»¤ï¼Œå°†ä¸Šä¸€æ­¥ä¸­çš„å»ºç­‘ç‰©æ©æ¨¡è½¬æ¢ä¸º geojsonï¼Œä¿å­˜åœ¨ predict_geojson_features æ–‡ä»¶å¤¹ä¸­ã€‚ docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu features /data/predict_segmentation-masks /data/predict_geojson_features usage: ./rs features [-h] --type {parking} --dataset DATASET masks out positional arguments: masks slippy map directory with segmentation masks out path to GeoJSON file to store features in optional arguments: -h, --help show this help message and exit --type {parking} type of feature to extract (default: None) --dataset DATASET path to dataset configuration file (default: None) ï¼ˆç›®å‰ features å‘½ä»¤ä¸­å¯¹ --type è®¾ç½®æœ‰ bugï¼Œæ— æ³•æ­£å¸¸æ‰§è¡Œã€‚ï¼‰ 4.5 åˆå¹¶æ©æ¨¡åˆ†å‰²çš„ geojsonâ€‹ é€šè¿‡ RoboSat çš„ merge å‘½ä»¤ï¼Œå°†ä¸Šä¸€æ­¥ä¸­ç”Ÿæˆçš„åˆ†å‰²çš„ geojson è¦ç´ è¿›è¡Œåˆå¹¶ï¼Œç»“æœä¿å­˜åœ¨ predict_geojson_mergeæ–‡ä»¶å¤¹ä¸­ã€‚ docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu features /data/predict_geojson /data/predict_geojson_merge usage: ./rs merge [-h] --threshold THRESHOLD features out positional arguments: features GeoJSON file to read features from out path to GeoJSON to save merged features to optional arguments: -h, --help show this help message and exit --threshold THRESHOLD minimum distance to adjacent features, in m (default:None)","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://geocompass.github.io/categories/å¤§æ•°æ®/"}],"tags":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://geocompass.github.io/tags/å¤§æ•°æ®/"}]}]}