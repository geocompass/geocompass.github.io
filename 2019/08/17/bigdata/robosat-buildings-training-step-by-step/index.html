<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>手把手教你用Mapbox的RoboSat基于深度学习自动提取建筑物 | 国信司南技术团队博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="设计、前端、后端、数据库、服务器">
  
  <meta name="description" content="原文链接：https://github.com/geocompass/robosat_buildings_training ​    本文介绍了如何使用 mapbox/robosat 工具，基于深度学习训练，从常规的遥感影像瓦片地图服务中自动提取建筑物。包括系统准备工作、数据准备工作和训练与建模。通过根据文章的描述，可以完成训练任务。 ​    参考文章：daniel-j-h : RoboSat">
<meta name="keywords" content="大数据">
<meta property="og:type" content="article">
<meta property="og:title" content="手把手教你用Mapbox的RoboSat基于深度学习自动提取建筑物">
<meta property="og:url" content="http://geocompass.github.io/2019/08/17/bigdata/robosat-buildings-training-step-by-step/index.html">
<meta property="og:site_name" content="国信司南技术团队博客">
<meta property="og:description" content="原文链接：https://github.com/geocompass/robosat_buildings_training ​    本文介绍了如何使用 mapbox/robosat 工具，基于深度学习训练，从常规的遥感影像瓦片地图服务中自动提取建筑物。包括系统准备工作、数据准备工作和训练与建模。通过根据文章的描述，可以完成训练任务。 ​    参考文章：daniel-j-h : RoboSat">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://github.com/geocompass/robosat_buildings_training/blob/master/img/buia_xiamen_preview.jpg">
<meta property="og:image" content="https://github.com/geocompass/robosat_buildings_training/blob/master/img/mask.gif">
<meta property="og:image" content="https://github.com/geocompass/robosat_buildings_training/blob/master/img/predict_region_geojson.jpg">
<meta property="og:image" content="https://github.com/geocompass/robosat_buildings_training/blob/master/img/predit_probabilities.gif">
<meta property="og:image" content="https://github.com/geocompass/robosat_buildings_training/blob/master/img/predit_masks.jpg">
<meta property="og:updated_time" content="2020-05-21T01:10:32.111Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="手把手教你用Mapbox的RoboSat基于深度学习自动提取建筑物">
<meta name="twitter:description" content="原文链接：https://github.com/geocompass/robosat_buildings_training ​    本文介绍了如何使用 mapbox/robosat 工具，基于深度学习训练，从常规的遥感影像瓦片地图服务中自动提取建筑物。包括系统准备工作、数据准备工作和训练与建模。通过根据文章的描述，可以完成训练任务。 ​    参考文章：daniel-j-h : RoboSat">
<meta name="twitter:image" content="https://github.com/geocompass/robosat_buildings_training/blob/master/img/buia_xiamen_preview.jpg">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>
  

  
  

</head>
</html>
<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">国信司南技术团队博客</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>档案</span>
                    </a>
                    
                    <a  href="/2019/08/21/write/write/#more">
                        <i class="fa fa-home"></i>
                        <span>写作</span>
                    </a>
                    
                    <a  href="/2019/08/21/about/index/#more">
                        <i class="fa fa-user"></i>
                        <span>我们</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/geocompass.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        国信司南技术团队博客
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        系统工程二部
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-bigdata/robosat-buildings-training-step-by-step" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      手把手教你用Mapbox的RoboSat基于深度学习自动提取建筑物
    </h1>
    <div class="post-title-bar">
      <ul>
          
              <li>
                  <i class="fa fa-book"></i>
                  
                      <a href="/categories/大数据/">大数据</a>
                  
              </li>
          
        <li>
          <i class="fa fa-calendar"></i>  2019-08-17
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <p>原文链接：<a href="https://github.com/geocompass/robosat_buildings_training" target="_blank" rel="noopener">https://github.com/geocompass/robosat_buildings_training</a></p>
<p>​    本文介绍了如何使用 <a href="https://github.com/mapbox/robosat" target="_blank" rel="noopener">mapbox/robosat</a> 工具，基于深度学习训练，从常规的遥感影像瓦片地图服务中自动提取建筑物。包括系统准备工作、数据准备工作和训练与建模。通过根据文章的描述，可以完成训练任务。</p>
<p>​    参考文章：<a href="https://www.openstreetmap.org/user/daniel-j-h/diary/44321" target="_blank" rel="noopener">daniel-j-h : RoboSat ❤️ Tanzania</a></p>
<ul>
<li><a href="#robosat_buildings_training">手把手教你如何使用 RoboSat 自动提取建筑物</a><ul>
<li><a href="#1-系统准备工作">1. 系统准备工作</a><ul>
<li><a href="#11-设备及系统">1.1 设备及系统</a></li>
<li><a href="#12-安装-docker">1.2 安装 Docker</a></li>
<li><a href="#13-在-docker-中安装-robosat">1.3 在 Docker 中安装 Robosat</a></li>
</ul>
</li>
<li><a href="#2-数据准备工作">2. 数据准备工作</a><ul>
<li><a href="#21-建筑物轮廓矢量数据">2.1 建筑物轮廓矢量数据</a></li>
<li><a href="#22-获取建筑物轮廓geojson数据">2.2 获取建筑物轮廓geojson数据</a></li>
<li><a href="#23-提取训练区覆盖的瓦片行列号">2.3 提取训练区覆盖的瓦片行列号</a></li>
<li><a href="#24-下载训练区遥感影像瓦片">2.4 下载训练区遥感影像瓦片</a></li>
<li><a href="#25-制作训练区矢量数据蒙版标记">2.5 制作训练区矢量数据蒙版标记</a></li>
</ul>
</li>
<li><a href="#3-训练和建模">3. 训练和建模</a><ul>
<li><a href="#31-分配训练数据验证数据评估数据">3.1 分配训练数据、验证数据、评估数据</a></li>
<li><a href="#32-权重计算">3.2 权重计算</a></li>
<li><a href="#33-开始训练">3.3 开始训练</a></li>
</ul>
</li>
<li><a href="#4-预测">4. 预测</a><ul>
<li><a href="#41-准备预测区域数据">4.1 准备预测区域数据</a></li>
<li><a href="#42-预测待提取建筑物概率">4.2 预测待提取建筑物概率</a></li>
<li><a href="#43-预测概率转换为建筑物掩模">4.3 预测概率转换为建筑物掩模</a></li>
<li><a href="#44-建筑物掩模转换为geojson">4.4 建筑物掩模转换为geojson</a></li>
<li><a href="#45-合并掩模分割的-geojson">4.5 合并掩模分割的 geojson</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>​ 参考文章：<a href="https://www.openstreetmap.org/user/daniel-j-h/diary/44321" target="_blank" rel="noopener">daniel-j-h : RoboSat ❤️ Tanzania</a></p>
<h2 id="1-系统准备工作"><a href="#1-系统准备工作" class="headerlink" title="1. 系统准备工作"></a>1. 系统准备工作</h2><h3 id="1-1-设备及系统"><a href="#1-1-设备及系统" class="headerlink" title="1.1 设备及系统"></a>1.1 设备及系统</h3><blockquote>
<p>准备一台安装 Linux 或 MacOS 系统的机器，可以是 CentOS、Ubuntu 或 MacOS。机器可以是实体机，也可以是 VMware 虚拟机。</p>
</blockquote>
<h3 id="1-2-安装-Docker"><a href="#1-2-安装-Docker" class="headerlink" title="1.2 安装 Docker"></a>1.2 安装 Docker</h3><blockquote>
<p>在机器中安装 Docker，不建议是 Windows 版 Docker。<a href="https://www.runoob.com/docker/macos-docker-install.html" target="_blank" rel="noopener">MacOS 安装 Docker</a> ，<a href="https://www.runoob.com/docker/centos-docker-install.html" target="_blank" rel="noopener">CentOS 安装 Docker</a></p>
</blockquote>
<h3 id="1-3-在-Docker-中安装-Robosat"><a href="#1-3-在-Docker-中安装-Robosat" class="headerlink" title="1.3 在 Docker 中安装 Robosat"></a>1.3 在 Docker 中安装 Robosat</h3><blockquote>
<p>Robosat 的 <a href="https://hub.docker.com/r/mapbox/robosat" target="_blank" rel="noopener">Docker Hub</a>。</p>
</blockquote>
<p>​ 可以使用两种方式安装 Robosat：</p>
<ul>
<li>使用 CPU 容器：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu --help</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 GPU 容器（主机上需要 <a href="https://github.com/NVIDIA/nvidia-docker" target="_blank" rel="noopener">nvidia-docker</a>）：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --runtime=nvidia -it --rm -v $PWD:/data --ipc=host mapbox/robosat:latest-gpu train --model /data/model.toml --dataset /data/dataset.toml --workers 4</span><br></pre></td></tr></table></figure>

<h2 id="2-数据准备工作"><a href="#2-数据准备工作" class="headerlink" title="2. 数据准备工作"></a>2. 数据准备工作</h2><h3 id="2-1-建筑物轮廓矢量数据"><a href="#2-1-建筑物轮廓矢量数据" class="headerlink" title="2.1 建筑物轮廓矢量数据"></a>2.1 建筑物轮廓矢量数据</h3><p>​ 已有的建筑物轮廓矢量数据用来作为建筑物提取的训练数据源。可以有两种方式获取：</p>
<ul>
<li>OSM 数据源，可以在 <a href="http://download.geofabrik.de/" target="_blank" rel="noopener">geofabrik</a> 获取，通过 <a href="https://github.com/osmcode/osmium-tool" target="_blank" rel="noopener">osmium</a> 和 <a href="https://github.com/mapbox/robosat" target="_blank" rel="noopener">robosat</a> 工具<a href="https://www.openstreetmap.org/user/daniel-j-h/diary/44321" target="_blank" rel="noopener">进行处理</a>。</li>
<li>自有数据源。通过 <a href="https://qgis.org/en/site/" target="_blank" rel="noopener">QGIS</a> 或 ArcMap 等工具，加载遥感影像底图，描述的建筑物轮廓 Shapefile 数据。</li>
</ul>
<p>​ <strong>本文使用第二种数据来源，并已<a href="https://github.com/geocompass/robosat_buildings_training/tree/master/shp_data" target="_blank" rel="noopener">开源数据源</a>，开源的矢量数据覆盖厦门核心区。</strong></p>
<p>​ <strong>考虑到使用个人电脑没有 CUDA 加速训练成本较高，本文使用 <a href="https://github.com/geocompass/robosat_buildings_training/blob/master/shp_data/buia_xiamen_min_shp.zip" target="_blank" rel="noopener">buia_xiamen_min_shp</a>，包含厦门核心区部分区域，共 5679 个建筑物轮廓。在 Docker 配置为 处理器(<code>CPU</code>) 4 核、内存(<code>RAM</code>)16GB、交换内存(<code>Swap</code>)3GB 时，训练时间大约 2.5 小时。</strong></p>
<p><img src="https://github.com/geocompass/robosat_buildings_training/blob/master/img/buia_xiamen_preview.jpg" alt="训练区矢量数据预览"></p>
<h3 id="2-2-获取建筑物轮廓-geojson-数据"><a href="#2-2-获取建筑物轮廓-geojson-数据" class="headerlink" title="2.2 获取建筑物轮廓 geojson 数据"></a>2.2 获取建筑物轮廓 geojson 数据</h3><p>​ 通过在线工具 <a href="https://mapshaper.org/" target="_blank" rel="noopener">mapshaper</a>，将 shapefile 数据转换为 geojson 数据。</p>
<h3 id="2-3-提取训练区覆盖的瓦片行列号"><a href="#2-3-提取训练区覆盖的瓦片行列号" class="headerlink" title="2.3 提取训练区覆盖的瓦片行列号"></a>2.3 提取训练区覆盖的瓦片行列号</h3><p>​ 使用 robosat 的 <a href="https://github.com/mapbox/robosat#rs-cover" target="_blank" rel="noopener">cover</a> 命令，即可获取当前训练区矢量数据覆盖的瓦片行列号，并使用 csv 文件存储。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu cover  --zoom 18 /data/buildings.json /data/buildings.tiles</span><br></pre></td></tr></table></figure>

<p><code>cover</code> 命令的参数介绍：</p>
<blockquote>
<p>usage: <code>./rs cover [-h] --zoom ZOOM features out</code></p>
<ul>
<li>positional arguments:<ul>
<li><code>features</code> path to GeoJSON features</li>
<li><code>out</code> path to csv file to store tiles in</li>
</ul>
</li>
<li>optional arguments:<ul>
<li><code>-h</code>, –help show this help message and exit</li>
<li><code>--zoom ZOOM</code> zoom level of tiles (default: None)</li>
</ul>
</li>
</ul>
</blockquote>
<p>这里是获取在 18 级下训练区覆盖的瓦片行列号。18 级是国内地图通用的最大级别，如果有国外更清晰数据源，可设置更高地图级别。</p>
<p>​ cover 工具对训练区矢量数据计算的瓦片行列号使用的是通用的 WGS84-&gt;Web 墨卡托投影坐标系。</p>
<blockquote>
<p>小知识：</p>
<ul>
<li><code>$PWD:/data</code> 是将当前路径映射为 docker 中的 <code>/data</code> 路径。</li>
<li>在新版 robosat 的 docker 安装包中，将 <code>./rs</code> 命令行工具对应为<code>docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu</code> 命令。</li>
<li>docker 版 robosat ，以命令行方式执行，无法生成类似 nginx 的 docker 服务，所以执行完成后立即销毁了 docker 的 container。</li>
</ul>
</blockquote>
<h3 id="2-4-下载训练区遥感影像瓦片"><a href="#2-4-下载训练区遥感影像瓦片" class="headerlink" title="2.4 下载训练区遥感影像瓦片"></a>2.4 下载训练区遥感影像瓦片</h3><p>​ 使用 robosat 的 <a href="https://github.com/mapbox/robosat#rs-download" target="_blank" rel="noopener">download</a> 工具，即可获取当前训练区矢量数据覆盖的遥感影像，下载的瓦片通过 2.3 节中的<strong>buildings.tiles</strong> 确定。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu download http://ditu.google.cn/maps/vt/lyrs=s&amp;x=&#123;x&#125;&amp;y=&#123;y&#125;&amp;z=&#123;z&#125; /data/buildings.tiles /data/tiles</span><br></pre></td></tr></table></figure>

<p>​ <code>download</code> 命令的参数介绍：</p>
<blockquote>
<p>usage: <code>./rs download [-h] [--ext EXT] [--rate RATE] url tiles out</code></p>
<ul>
<li>positional arguments:<ul>
<li><code>url</code> endpoint with {z}/{x}/{y} variables to fetch image tiles from</li>
<li><code>tiles</code> path to .csv tiles file</li>
<li><code>out</code> path to slippy map directory for storing tiles</li>
</ul>
</li>
<li>optional arguments:<ul>
<li><code>-h</code>, –help show this help message and exit</li>
<li><code>--ext EXT</code> file format to save images in (default: webp)</li>
<li><code>--rate RATE</code> rate limit in max. requests per second (default: 10)</li>
</ul>
</li>
</ul>
</blockquote>
<p>​ 这里介绍几个常用的 Web 墨卡托投影的（WGS84 坐标系）遥感影像数据源：</p>
<blockquote>
<ul>
<li><a href="https://ditu.google.cn/" target="_blank" rel="noopener">谷歌地图 CN 影像</a>：<a href="http://ditu.google.cn/maps/vt/lyrs=s&amp;x={x}&amp;y={y}&amp;z={z}" target="_blank" rel="noopener">http://ditu.google.cn/maps/vt/lyrs=s&amp;x={x}&amp;y={y}&amp;z={z}</a></li>
<li><a href="https://map.tianditu.gov.cn/" target="_blank" rel="noopener">天地图影像</a>：<a href="https://t4.tianditu.gov.cn/DataServer?T=img_w&amp;x={x}&amp;y={y}&amp;l={z}&amp;tk=2ce94f67e58faa24beb7cb8a09780552" target="_blank" rel="noopener">https://t4.tianditu.gov.cn/DataServer?T=img_w&amp;x={x}&amp;y={y}&amp;l={z}&amp;tk=2ce94f67e58faa24beb7cb8a09780552</a></li>
<li><a href="https://server.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer?f=jsapi" target="_blank" rel="noopener">ArcGIS Online 影像</a>：<a href="https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}" target="_blank" rel="noopener">https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}</a></li>
<li><a href="https://api.mapbox.com/styles/v1/mapbox/satellite-v9.html?title=true&access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA#0.75/29.3/-124.8" target="_blank" rel="noopener">MapBox 影像</a>：<a href="https://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}@2x.png?sku=101KOLcQaDwG1&amp;access_token=[token]" target="_blank" rel="noopener">https://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}@2x.png?sku=101KOLcQaDwG1&amp;access_token=[token]</a></li>
</ul>
</blockquote>
<p>​ 几种遥感影像数据源的比较：</p>
<ul>
<li><p>从访问速度来看，天地图&gt;谷歌&gt;ArcGIS&gt;Mapbox。</p>
</li>
<li><p>从遥感影像的质量来说，总体来说：</p>
<ul>
<li>城市地区：谷歌=ArcGIS&gt;天地图&gt;Mapbox</li>
<li>农村地图：谷歌&gt;天地图&gt;ArcGIS&gt;Mapbox</li>
</ul>
</li>
<li><p>层级覆盖：谷歌&gt;天地图&gt;ArcGIS&gt;Mapbox</p>
</li>
</ul>
<p>​ 不同影像数据源的质量不能一概而论，由于传感器不同、过境时间不同等因素，不同地区的影像数据源质量均不同，建议使用 QGIS 加载训练区位置的影像对比选择。</p>
<h3 id="2-5-制作训练区矢量数据蒙版标记"><a href="#2-5-制作训练区矢量数据蒙版标记" class="headerlink" title="2.5 制作训练区矢量数据蒙版标记"></a>2.5 制作训练区矢量数据蒙版标记</h3><p>​ 使用 2.2 节中制作的 geojson 数据，通过 robosat 的 <a href="https://github.com/mapbox/robosat#rs-rasterize" target="_blank" rel="noopener">rasterize</a> 工具可制作训练区矢量数据的蒙版标记数据。蒙版标记数据与瓦片数据一一相对应，使用同样的 <strong>buildings.tiles</strong> 瓦片列表产生。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu rasterize --dataset /data/dataset-building.toml --zoom 18 --size 256 /data/buildings.json /data/buildings.tiles /data/masks</span><br></pre></td></tr></table></figure>

<p>​ <code>rasterise</code> 命令的参数介绍：</p>
<blockquote>
<p>usage: <code>./rs rasterize [-h] --dataset DATASET --zoom ZOOM [--size SIZE] features tiles out</code></p>
<ul>
<li><p>positional arguments:</p>
<ul>
<li><code>features</code> path to GeoJSON features file</li>
<li><code>tiles</code> path to .csv tiles file</li>
<li><code>out</code> directory to write converted images</li>
</ul>
</li>
<li><p>optional arguments:<br><code>-h</code>, <code>--help</code> show this help message and exit<br><code>--dataset DATASET</code> path to dataset configuration file (default: None)<br><code>--zoom ZOOM</code> zoom level of tiles (default: None)<br><code>--size SIZE</code> size of rasterized image tiles in pixels (default: 512)</p>
</li>
</ul>
</blockquote>
<p>这里使用到了 <code>dataset-building.toml</code> 配置文件，文件中配置了瓦片地图路径、分类方式、蒙版标记的颜色等信息。示例配置可以查看官方示例文件 <a href="https://github.com/mapbox/robosat/blob/master/config/dataset-parking.toml" target="_blank" rel="noopener">dataset-parking.toml</a> 。本训练中用到的 <a href="https://github.com/geocompass/robosat_buildings_training/dataset-building.toml" target="_blank" rel="noopener">dataset-building.toml</a> 的配置内容如下：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Configuration related to a specific dataset.</span></span><br><span class="line"><span class="comment"># For syntax see: https://github.com/toml-lang/toml#table-of-contents</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Dataset specific common attributes.</span></span><br><span class="line"><span class="section">[common]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># The slippy map dataset's base directory.</span></span><br><span class="line">  dataset = '/Users/wucan/Document/robosat/tiles/'</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Human representation for classes.</span></span><br><span class="line">  classes = ['background', 'buildings']</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Color map for visualization and representing classes in masks.</span></span><br><span class="line">  <span class="comment"># <span class="doctag">Note:</span> available colors can be found in `robosat/colors.py`</span></span><br><span class="line">  colors  = ['denim', 'orange']</span><br></pre></td></tr></table></figure>

<p>​ 配置文档中，最重要的是配置 <code>dataset</code> 目录，也就是上一步中下载的遥感影像瓦片路径。制作的蒙版标记效果如下图。</p>
<p><img src="https://github.com/geocompass/robosat_buildings_training/blob/master/img/mask.gif" alt="mask"></p>
<p>​ 至此，训练和建模所需的瓦片和蒙版标记已经全部准备完，分别在 <code>tiles</code> 和 <code>masks</code> 目录中。</p>
<h2 id="3-训练和建模"><a href="#3-训练和建模" class="headerlink" title="3. 训练和建模"></a>3. 训练和建模</h2><h3 id="3-1-分配训练数据、验证数据、评估数据"><a href="#3-1-分配训练数据、验证数据、评估数据" class="headerlink" title="3.1 分配训练数据、验证数据、评估数据"></a>3.1 分配训练数据、验证数据、评估数据</h3><p>​ RoboSat 分割模型是一个完全卷积的神经网络，需要将上一步准备好的数据集拆分为三部分，分别为<code>训练数据集</code> 、<code>验证数据集</code>、<code>评估数据集</code>，比例分别为 80%、10%、10%。每一部分的数据集中，都包含影像瓦片和蒙版标记瓦片。</p>
<ul>
<li><p>训练数据集：a training dataset on which we train the model on</p>
</li>
<li><p>验证数据集：a validation dataset on which we calculate metrics on after training</p>
</li>
<li><p>评估数据集：a hold-out evaluation dataset if you want to do hyper-parameter tuning</p>
<p>将步骤 2 中的数据进行随机分配的过程非常简单：</p>
</li>
<li><p>新建三个 csv 文件： <code>csv_training.tiles</code> 、<code>csv_validation.tiles</code>、 <code>csv_evaluation.tiles</code></p>
</li>
<li><p>将 <code>buildings.tiles</code> 中的瓦片列表随机按 80%、10%、10% 比例进行拷贝与粘贴。注意三个文件间的瓦片列表内容不能重复。</p>
</li>
</ul>
<p>​ 使用 RoboSat 中的 <a href="https://github.com/mapbox/robosat#rs-subset" target="_blank" rel="noopener">subset</a> 命令，将 <code>tiles</code> 和 <code>masks</code> 中的瓦片和蒙版按照上面三个 csv 文件的瓦片列表分配进行组织影像瓦片和蒙版标记数据。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 准备训练数据集</span></span><br><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/tiles/ /data/csv_training.tiles /data/dataset/training/images</span><br><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/masks/ /data/csv_training.tiles /data/dataset/training/labels</span><br><span class="line"><span class="meta">#</span><span class="bash"> 准备验证数据集</span></span><br><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/tiles/ /data/csv_validation.tiles /data/dataset/validation/images</span><br><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/masks/ /data/csv_validation.tiles /data/dataset/validation/labels</span><br><span class="line"><span class="meta">#</span><span class="bash"> 准备评估数据集</span></span><br><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/tiles/ /data/csv_evaluation.tiles /data/dataset/evaluation/images</span><br><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu subset /data/masks/ /data/csv_evaluation.tiles /data/dataset/evaluation/labels</span><br></pre></td></tr></table></figure>

<p>​ <code>subset</code> 命令的参数介绍：</p>
<blockquote>
<p>usage: <code>./rs subset [-h] images tiles out</code></p>
<ul>
<li><p>positional arguments:</p>
<ul>
<li><code>images</code> directory to read slippy map image tiles from for filtering</li>
<li><code>tiles</code> csv to filter images by</li>
<li><code>out</code> directory to save filtered images to</li>
</ul>
</li>
<li><p>optional arguments:</p>
<ul>
<li><code>-h</code>, <code>--help</code> show this help message and exit</li>
</ul>
</li>
</ul>
</blockquote>
<p>​ 分类完成以后，将会生成 <code>/data/dataset</code> 目录，目录结构如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dataset</span><br><span class="line">|  training</span><br><span class="line">|  |  images</span><br><span class="line">|  |  labels</span><br><span class="line">|  validataion</span><br><span class="line">|  |  images</span><br><span class="line">|  |  labels</span><br><span class="line">|  evaluation</span><br><span class="line">|  |  images</span><br><span class="line">|  |  labels</span><br></pre></td></tr></table></figure>

<h3 id="3-2-权重计算"><a href="#3-2-权重计算" class="headerlink" title="3.2 权重计算"></a>3.2 权重计算</h3><p>​ 因为前景和背景在数据集中分布不均，可以使用 RoboSat 中的 <a href="https://github.com/mapbox/robosat#rs-weights" target="_blank" rel="noopener">weights</a> 命令，在模型训练之前计算一下每个类的分布。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu weights --dataset /data/dataset-building-weights.toml</span><br></pre></td></tr></table></figure>

<p>​ <code>weights</code> 命令的参数如下：</p>
<blockquote>
<p>usage: <code>./rs weights [-h] --dataset DATASET</code></p>
<ul>
<li>optional arguments:<ul>
<li><code>-h</code>, <code>--help</code> show this help message and exit</li>
<li><code>--dataset DATASET</code> path to dataset configuration file (default: None)</li>
</ul>
</li>
</ul>
</blockquote>
<p>​ 这里，用到了<code>dataset-building-weights.toml</code> ，是将前面步骤中的 <code>dataset-building.toml</code> 瓦片路径修改为包含训练数据集 <code>dataset</code> 的路径。执行权重计算命令后，得到权重为：<code>values = [1.653415, 5.266637]</code> 。将其追加到 <code>dataset-building-weights.toml</code> 文件中，结果如下。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Configuration related to a specific dataset.</span><br><span class="line"># For syntax see: https://github.com/toml-lang/toml#table-of-contents</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Dataset specific common attributes.</span><br><span class="line">[common]</span><br><span class="line"></span><br><span class="line">  # The slippy map dataset&apos;s base directory.</span><br><span class="line">  dataset = &apos;/data/dataset&apos;</span><br><span class="line"></span><br><span class="line">  # Human representation for classes.</span><br><span class="line">  classes = [&apos;background&apos;, &apos;buildings&apos;]</span><br><span class="line"></span><br><span class="line">  # Color map for visualization and representing classes in masks.</span><br><span class="line">  # Note: available colors can be found in `robosat/colors.py`</span><br><span class="line">  colors  = [&apos;denim&apos;, &apos;orange&apos;]</span><br><span class="line"></span><br><span class="line"># Dataset specific class weights computes on the training data.</span><br><span class="line"># Needed by &apos;mIoU&apos; and &apos;CrossEntropy&apos; losses to deal with unbalanced classes.</span><br><span class="line"># Note: use `./rs weights -h` to compute these for new datasets.</span><br><span class="line">[weights]</span><br><span class="line">  values = [1.653415, 5.266637]</span><br></pre></td></tr></table></figure>

<h3 id="3-3-开始训练"><a href="#3-3-开始训练" class="headerlink" title="3.3 开始训练"></a>3.3 开始训练</h3><p>​ RoboSat 使用 <a href="https://github.com/mapbox/robosat#rs-train" target="_blank" rel="noopener">train</a> 命令进行训练。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu train --model /data/model-unet.toml --dataset /data/dataset-building-weights.toml</span><br></pre></td></tr></table></figure>

<p>​ <code>train</code> 命令的参数如下：</p>
<blockquote>
<p>usage: <code>./rs train [-h] --model MODEL --dataset DATASET [--checkpoint CHECKPOINT] [--resume RESUME] [--workers WORKERS]</code></p>
<ul>
<li><p>positional arguments:</p>
<ul>
<li><code>--model MODEL</code> path to model configuration file (default: None)</li>
<li><code>--dataset DATASET</code> path to dataset configuration file (default: None)</li>
</ul>
</li>
<li><p>optional arguments:</p>
<ul>
<li><code>-h</code>, `–help show this help message and exit</li>
<li><code>--checkpoint CHECKPOINT</code> path to a model checkpoint (to retrain) (default: None)</li>
<li><code>--resume RESUME</code> resume training or fine-tuning (if checkpoint) (default: False)</li>
<li><code>--workers WORKERS</code> number of workers pre-processi ng images (default: 0)</li>
</ul>
</li>
</ul>
</blockquote>
<p>​ 这里多了一个配置文件 <code>model-unet.toml</code> ，这个配置文件主要用来配置训练过程中的参数，包括是否启用 CUDA 、训练批次大小、影像瓦片的像素大小、检查点存储路径等。官方给出了<a href="https://github.com/mapbox/robosat/blob/master/config/model-unet.toml" target="_blank" rel="noopener">示例配置文件</a>，根据本实验的情况做了修改如下，配置如下。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Configuration related to a specific model.</span><br><span class="line"># For syntax see: https://github.com/toml-lang/toml#table-of-contents</span><br><span class="line"></span><br><span class="line"># Model specific common attributes.</span><br><span class="line">[common]</span><br><span class="line"></span><br><span class="line">  # Use CUDA for GPU acceleration.</span><br><span class="line">  cuda       = false</span><br><span class="line"></span><br><span class="line">  # Batch size for training.</span><br><span class="line">  batch_size = 2</span><br><span class="line"></span><br><span class="line">  # Image side size in pixels.</span><br><span class="line">  image_size = 256</span><br><span class="line"></span><br><span class="line">  # Directory where to save checkpoints to during training.</span><br><span class="line">  checkpoint = &apos;/data/checkpoint/&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Model specific optimization parameters.</span><br><span class="line">[opt]</span><br><span class="line"></span><br><span class="line">  # Total number of epochs to train for.</span><br><span class="line">  epochs     = 10</span><br><span class="line"></span><br><span class="line">  # Learning rate for the optimizer.</span><br><span class="line">  lr         = 0.01</span><br><span class="line"></span><br><span class="line">  # Loss function name (e.g &apos;Lovasz&apos;, &apos;mIoU&apos; or &apos;CrossEntropy&apos;)</span><br><span class="line">  loss = &apos;Lovasz&apos;</span><br></pre></td></tr></table></figure>

<p>​ RoboSat 会进行多次迭代训练，每次迭代训练都会保存检查点(checkpoint)和各项指标等。其中，训练日志例如：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">--- Hyper Parameters on Dataset: /data/dataset ---</span><br><span class="line">Batch Size:	 2</span><br><span class="line">Image Size:	 256</span><br><span class="line">Learning Rate:	 0.0001</span><br><span class="line">Loss function:	 Lovasz</span><br><span class="line">Weights :	 [1.644471, 5.409126]</span><br><span class="line">---</span><br><span class="line">Epoch: 1/10</span><br><span class="line">Train    loss: 0.3190, mIoU: 0.410, buildings IoU: 0.017, MCC: -0.002</span><br><span class="line">Validate loss: 0.3171, mIoU: 0.405, buildings IoU: 0.000, MCC: nan</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Epoch: 10/10</span><br><span class="line">Train    loss: 0.2693, mIoU: 0.528, buildings IoU: 0.229, MCC: 0.330</span><br><span class="line">Validate loss: 0.2880, mIoU: 0.491, buildings IoU: 0.167, MCC: 0.262</span><br></pre></td></tr></table></figure>

<p>​ 可以选择最好的训练结果，保留其检查点( <code>checkpoint-***.pth</code> )，进入下一步 <code>predict</code>。一般来说，最后一个检查点效果最好。</p>
<h2 id="4-预测"><a href="#4-预测" class="headerlink" title="4. 预测"></a>4. 预测</h2><h3 id="4-1-准备预测区域数据"><a href="#4-1-准备预测区域数据" class="headerlink" title="4.1 准备预测区域数据"></a>4.1 准备预测区域数据</h3><p>​ RoboSat 仅支持从影像瓦片中提取建筑物，不支持从任意的 jpg 图片中提取。所以我们需要先准备预测区域的瓦片数据。</p>
<p>​ 通过 <a href="http://geojson.io/" target="_blank" rel="noopener">geojson.io</a> 绘制想要提取建筑物的范围，使用矩形框即可。将自动生成的 geojson 保存为 <code>predict_test.json</code>。</p>
<p>​ 通过 2.3 中的 <code>cover</code> 命令，获取待提取范围的瓦片列表 csv 文件，保存到 <code>buildings_predict.tiles</code> 文件中。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu cover  --zoom 18 /data/shp_data/predict_test.json /data/buildings_predict.tiles</span><br></pre></td></tr></table></figure>

<p>​ 使用 2.4 中的 <code>download</code> 命令，下载待提取范围的影像瓦片，保存到 <code>images_predict</code> 文件夹中。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu download https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/&#123;z&#125;/&#123;y&#125;/&#123;x&#125; /data/buildings_predict.tiles /data/images_predict</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/geocompass/robosat_buildings_training/blob/master/img/predict_region_geojson.jpg" alt="预测区域的geojson"></p>
<h3 id="4-2-预测待提取建筑物概率"><a href="#4-2-预测待提取建筑物概率" class="headerlink" title="4.2 预测待提取建筑物概率"></a>4.2 预测待提取建筑物概率</h3><p>​ 使用保存的检查点来（<code>checkpint</code>）预测图像中每个像素的分割概率，这些分割概率表示每个像素是建筑物还是背景的可能性，然后可以将这些概率转换为离散的分割掩模。</p>
<p>​ 通过 RoboSat 的 <a href="https://github.com/mapbox/robosat#rs-predict" target="_blank" rel="noopener">predict</a> 命令，将待预测区域的建筑物（ <code>images_predict</code> ）提取为分割概率（<code>predict_segmentation-probabilities</code>）。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it -d --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu predict --tile_size 256 --model /data/model-unet.toml --dataset /data/dataset-building.toml --checkpoint /data/checkpoint/checkpoint-00010-of-00010.pth /data/images_predict /data/predict_segmentation-probabilities</span><br></pre></td></tr></table></figure>

<p>​ <code>predict</code> 命令的参数如下：</p>
<blockquote>
<p>usage: <code>./rs predict [-h] [--batch_size BATCH_SIZE] --checkpoint CHECKPOINT [--overlap OVERLAP] --tile_size TILE_SIZE [--workers WORKERS] --model MODEL --dataset DATASET tiles probs</code></p>
<ul>
<li><p>positional arguments:</p>
<ul>
<li><code>tiles</code> directory to read slippy map image tiles from</li>
<li><code>probs</code> directory to save slippy map probability masks to</li>
</ul>
</li>
<li><p>optional arguments:</p>
<ul>
<li><code>-h</code>, <code>--help show this help message and exit</code></li>
<li><code>--batch_size BATCH_SIZE</code> images per batch (default: 1)</li>
<li><code>--checkpoint CHECKPOINT</code> model checkpoint to load (default: None)</li>
<li><code>--overlap OVERLAP</code> tile pixel overlap to predict on (default: 32)</li>
<li><code>--tile_size TILE_SIZE</code> tile size for slippy map tiles (default: None)</li>
<li><code>--workers WORKERS</code> number of workers pre-processing images (default: 0)</li>
<li><code>--model MODEL</code> path to model configuration file (default: None)</li>
<li><code>--dataset DATASET</code> path to dataset configuration file (default: None)</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="https://github.com/geocompass/robosat_buildings_training/blob/master/img/predit_probabilities.gif" alt="预测建筑物提取概率结果"></p>
<h3 id="4-3-预测概率转换为建筑物掩模"><a href="#4-3-预测概率转换为建筑物掩模" class="headerlink" title="4.3 预测概率转换为建筑物掩模"></a>4.3 预测概率转换为建筑物掩模</h3><p>​ 通过 RoboSat 的 <a href="https://github.com/mapbox/robosat#rs-masks" target="_blank" rel="noopener">masks</a> 命令，将上一步中的建筑物预测概率结果转换为建筑物掩模（<code>masks</code>），保存到 <code>predict_segmentation-masks</code> 文件夹中。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it -d --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu masks /data/predict_segmentation-masks /data/predict_segmentation-probabilities</span><br></pre></td></tr></table></figure>

<blockquote>
<p>usage: <code>./rs masks [-h] [--weights WEIGHTS [WEIGHTS ...]] masks probs [probs ...]</code></p>
<ul>
<li><p>positional arguments:</p>
<ul>
<li><code>masks</code> slippy map directory to save masks to</li>
<li><code>probs</code> slippy map directories with class probabilities</li>
</ul>
</li>
<li><p>optional arguments:</p>
<ul>
<li><code>-h</code>, <code>--help</code> show this help message and exit</li>
<li><code>--weights WEIGHTS [WEIGHTS ...]</code> weights for weighted average soft-voting (default:<br>None)</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="https://github.com/geocompass/robosat_buildings_training/blob/master/img/predit_masks.jpg" alt="预测建筑物提取掩模结果"></p>
<h3 id="4-4-建筑物掩模转换为-geojson"><a href="#4-4-建筑物掩模转换为-geojson" class="headerlink" title="4.4 建筑物掩模转换为 geojson"></a>4.4 建筑物掩模转换为 geojson</h3><p>​ 通过 RoboSat 的 <a href>features</a> 命令，将上一步中的建筑物掩模转换为 geojson，保存在 <code>predict_geojson_features</code> 文件夹中。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu features /data/predict_segmentation-masks /data/predict_geojson_features</span><br></pre></td></tr></table></figure>

<blockquote>
<p>usage: <code>./rs features [-h] --type {parking} --dataset DATASET masks out</code></p>
<ul>
<li><p>positional arguments:</p>
<ul>
<li><code>masks</code> slippy map directory with segmentation masks</li>
<li><code>out</code> path to GeoJSON file to store features in</li>
</ul>
</li>
<li><p>optional arguments:</p>
<ul>
<li><code>-h</code>, <code>--help</code> show this help message and exit</li>
<li><code>--type {parking}</code> type of feature to extract (default: None)</li>
<li><code>--dataset DATASET</code> path to dataset configuration file (default: None)</li>
</ul>
</li>
</ul>
</blockquote>
<p>（目前 <code>features</code> 命令中对 <code>--type</code> 设置有 bug，无法正常执行。）</p>
<h3 id="4-5-合并掩模分割的-geojson"><a href="#4-5-合并掩模分割的-geojson" class="headerlink" title="4.5 合并掩模分割的 geojson"></a>4.5 合并掩模分割的 geojson</h3><p>​ 通过 RoboSat 的 <a href="https://github.com/mapbox/robosat#rs-merge" target="_blank" rel="noopener">merge</a> 命令，将上一步中生成的分割的 geojson 要素进行合并，结果保存在 <code>predict_geojson_merge</code>文件夹中。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run -it --rm -v $PWD:/data --ipc=host --network=host mapbox/robosat:latest-cpu features /data/predict_geojson /data/predict_geojson_merge</span><br></pre></td></tr></table></figure>

<blockquote>
<p>usage: <code>./rs merge [-h] --threshold THRESHOLD features out</code></p>
<ul>
<li><p>positional arguments:</p>
<ul>
<li><code>features</code> GeoJSON file to read features from</li>
<li><code>out</code> path to GeoJSON to save merged features to</li>
</ul>
</li>
<li><p>optional arguments:</p>
<ul>
<li><code>-h</code>, <code>--help</code> show this help message and exit</li>
<li><code>--threshold THRESHOLD</code> minimum distance to adjacent features, in m (default:<br>None)</li>
</ul>
</li>
</ul>
</blockquote>

            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2020年05月21日 09:10</p>
        <p>原始链接： <a class="post-url" href="/2019/08/17/bigdata/robosat-buildings-training-step-by-step/" title="手把手教你用Mapbox的RoboSat基于深度学习自动提取建筑物">http://geocompass.github.io/2019/08/17/bigdata/robosat-buildings-training-step-by-step/</a></p>
        <footer>
            <a href="http://geocompass.github.io">
                <img src="/images/geocompass.png" alt="Geo-Compass">
                Geo-Compass
            </a>
        </footer>
    </div>
</div>

      
        
            

        
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://geocompass.github.io/2019/08/17/bigdata/robosat-buildings-training-step-by-step/&title=《手把手教你用Mapbox的RoboSat基于深度学习自动提取建筑物》 — 国信司南技术团队博客&pic=http://geocompass.github.ioimages/geocompass.png" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://geocompass.github.io/2019/08/17/bigdata/robosat-buildings-training-step-by-step/&title=《手把手教你用Mapbox的RoboSat基于深度学习自动提取建筑物》 — 国信司南技术团队博客&source=团队技术博客" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://geocompass.github.io/2019/08/17/bigdata/robosat-buildings-training-step-by-step/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《手把手教你用Mapbox的RoboSat基于深度学习自动提取建筑物》 — 国信司南技术团队博客&url=http://geocompass.github.io/2019/08/17/bigdata/robosat-buildings-training-step-by-step/&via=http://geocompass.github.io" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://geocompass.github.io/2019/08/17/bigdata/robosat-buildings-training-step-by-step/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://geocompass.github.io/2019/08/17/bigdata/robosat-buildings-training-step-by-step/" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/tags/大数据/" class="color4">大数据</a>
      
  </li>

        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-系统准备工作"><span class="post-toc-text">1. 系统准备工作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-1-设备及系统"><span class="post-toc-text">1.1 设备及系统</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-2-安装-Docker"><span class="post-toc-text">1.2 安装 Docker</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-3-在-Docker-中安装-Robosat"><span class="post-toc-text">1.3 在 Docker 中安装 Robosat</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-数据准备工作"><span class="post-toc-text">2. 数据准备工作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-1-建筑物轮廓矢量数据"><span class="post-toc-text">2.1 建筑物轮廓矢量数据</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-2-获取建筑物轮廓-geojson-数据"><span class="post-toc-text">2.2 获取建筑物轮廓 geojson 数据</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-3-提取训练区覆盖的瓦片行列号"><span class="post-toc-text">2.3 提取训练区覆盖的瓦片行列号</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-4-下载训练区遥感影像瓦片"><span class="post-toc-text">2.4 下载训练区遥感影像瓦片</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-5-制作训练区矢量数据蒙版标记"><span class="post-toc-text">2.5 制作训练区矢量数据蒙版标记</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-训练和建模"><span class="post-toc-text">3. 训练和建模</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1-分配训练数据、验证数据、评估数据"><span class="post-toc-text">3.1 分配训练数据、验证数据、评估数据</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2-权重计算"><span class="post-toc-text">3.2 权重计算</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3-开始训练"><span class="post-toc-text">3.3 开始训练</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4-预测"><span class="post-toc-text">4. 预测</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-1-准备预测区域数据"><span class="post-toc-text">4.1 准备预测区域数据</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-2-预测待提取建筑物概率"><span class="post-toc-text">4.2 预测待提取建筑物概率</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-3-预测概率转换为建筑物掩模"><span class="post-toc-text">4.3 预测概率转换为建筑物掩模</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-4-建筑物掩模转换为-geojson"><span class="post-toc-text">4.4 建筑物掩模转换为 geojson</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-5-合并掩模分割的-geojson"><span class="post-toc-text">4.5 合并掩模分割的 geojson</span></a></li></ol></li></ol>
        </nav>
    </aside>
    

<nav id="article-nav">
  
    <a href="/2019/08/21/write/write/" id="article-nav-newer" class="article-nav-link-wrap">

      <span class="article-nav-title">
        <i class="fa fa-hand-o-left" aria-hidden="true"></i>
        
          关于写作
        
      </span>
    </a>
  
  
</nav>



    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      

      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2020 Geo-Compass<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "http://geocompass.github.io",
      animate: true,
      isHome: false,
      share: true,
      reward: 0
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/写作/">写作</a><a class="category-link" href="/categories/前端/">前端</a><a class="category-link" href="/categories/后端/">后端</a><a class="category-link" href="/categories/国信司南/">国信司南</a><a class="category-link" href="/categories/大数据/">大数据</a><a class="category-link" href="/categories/数据库/">数据库</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/Egg-js/" style="font-size: 10px;">Egg.js</a> <a href="/tags/PostGIS/" style="font-size: 10px;">PostGIS</a> <a href="/tags/PostgreSQL/" style="font-size: 10px;">PostgreSQL</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/taro/" style="font-size: 10px;">taro</a> <a href="/tags/关于我们/" style="font-size: 10px;">关于我们</a> <a href="/tags/写作/" style="font-size: 10px;">写作</a> <a href="/tags/前端工具/" style="font-size: 20px;">前端工具</a> <a href="/tags/地图工具/" style="font-size: 10px;">地图工具</a> <a href="/tags/大数据/" style="font-size: 10px;">大数据</a> <a href="/tags/小程序/" style="font-size: 10px;">小程序</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="/archives">
                    <i class="fa fa-archive"></i><span>档案</span>
                </a>
            </li>
            
            <li>
                <a  href="/2019/08/21/write/write/#more">
                    <i class="fa fa-home"></i><span>写作</span>
                </a>
            </li>
            
            <li>
                <a  href="/2019/08/21/about/index/#more">
                    <i class="fa fa-user"></i><span>我们</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/Egg-js/" style="font-size: 10px;">Egg.js</a> <a href="/tags/PostGIS/" style="font-size: 10px;">PostGIS</a> <a href="/tags/PostgreSQL/" style="font-size: 10px;">PostgreSQL</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/taro/" style="font-size: 10px;">taro</a> <a href="/tags/关于我们/" style="font-size: 10px;">关于我们</a> <a href="/tags/写作/" style="font-size: 10px;">写作</a> <a href="/tags/前端工具/" style="font-size: 20px;">前端工具</a> <a href="/tags/地图工具/" style="font-size: 10px;">地图工具</a> <a href="/tags/大数据/" style="font-size: 10px;">大数据</a> <a href="/tags/小程序/" style="font-size: 10px;">小程序</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
<script src="/js/search.js"></script>
<script src="/js/main.js"></script>


  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  <script src="/js/particles.js"></script>







  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  <script src="/js/animate.js"></script>


  <script src="/js/pop-img.js"></script>
  <script>
     $(".article-entry p img").popImg();
  </script>

  </div>
</body>
</html>